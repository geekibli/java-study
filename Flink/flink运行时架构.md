---
title: Flink è¿è¡Œæ—¶æ¶æ„
toc: true
date: 2021-07-04 20:45:57
tags: Apache Flink
categories: Apache Flink
---

## Flinkè¿è¡Œæ—¶ç»„ä»¶
1. JobManager (ä½œä¸šç®¡ç†å™¨)
    JobManager å…·æœ‰è®¸å¤šä¸åè°ƒ Flink åº”ç”¨ç¨‹åºçš„åˆ†å¸ƒå¼æ‰§è¡Œæœ‰å…³çš„èŒè´£ï¼šå®ƒå†³å®šä½•æ—¶è°ƒåº¦ä¸‹ä¸€ä¸ª taskï¼ˆæˆ–ä¸€ç»„ taskï¼‰ã€å¯¹å®Œæˆçš„ task æˆ–æ‰§è¡Œå¤±è´¥åšå‡ºååº”ã€åè°ƒ checkpointã€å¹¶ä¸”åè°ƒä»å¤±è´¥ä¸­æ¢å¤ç­‰ç­‰ã€‚è¿™ä¸ªè¿›ç¨‹ç”±ä¸‰ä¸ªä¸åŒçš„ç»„ä»¶ç»„æˆï¼š

   - `ResourceManager`
    ResourceManager è´Ÿè´£ Flink é›†ç¾¤ä¸­çš„èµ„æºæä¾›ã€å›æ”¶ã€åˆ†é… - å®ƒç®¡ç† `task slots`ï¼Œè¿™æ˜¯ Flink é›†ç¾¤ä¸­èµ„æºè°ƒåº¦çš„å•ä½ã€‚Flink ä¸ºä¸åŒçš„ç¯å¢ƒå’Œèµ„æºæä¾›è€…ï¼ˆä¾‹å¦‚ YARNã€Mesosã€Kubernetes å’Œ standalone éƒ¨ç½²ï¼‰å®ç°äº†å¯¹åº”çš„ `ResourceManager`ã€‚åœ¨ standalone è®¾ç½®ä¸­ï¼ŒResourceManager åªèƒ½åˆ†é…å¯ç”¨ TaskManager çš„ slotsï¼Œè€Œä¸èƒ½è‡ªè¡Œå¯åŠ¨æ–°çš„ TaskManagerã€‚

   - `Dispatcher`
    Dispatcher æä¾›äº†ä¸€ä¸ª `REST` æ¥å£ï¼Œç”¨æ¥æäº¤ Flink åº”ç”¨ç¨‹åºæ‰§è¡Œï¼Œå¹¶ä¸ºæ¯ä¸ªæäº¤çš„ä½œä¸šå¯åŠ¨ä¸€ä¸ªæ–°çš„ `JobMaster`ã€‚å®ƒè¿˜è¿è¡Œ Flink WebUI ç”¨æ¥æä¾›ä½œä¸šæ‰§è¡Œä¿¡æ¯ã€‚

   - `JobMaster`
    `JobMaster` è´Ÿè´£ç®¡ç†å•ä¸ª `JobGraph` çš„æ‰§è¡Œã€‚Flink é›†ç¾¤ä¸­å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªä½œä¸šï¼Œæ¯ä¸ªä½œä¸šéƒ½æœ‰è‡ªå·±çš„ `JobMasterã€‚`
    å§‹ç»ˆè‡³å°‘æœ‰ä¸€ä¸ª `JobManager`ã€‚é«˜å¯ç”¨ï¼ˆHAï¼‰è®¾ç½®ä¸­å¯èƒ½æœ‰å¤šä¸ª `JobManager`ï¼Œå…¶ä¸­ä¸€ä¸ªå§‹ç»ˆæ˜¯ leaderï¼Œå…¶ä»–çš„åˆ™æ˜¯ `standby`ã€‚

1. TaskManager ï¼ˆä»»åŠ¡ç®¡ç†å™¨ï¼‰

  - Flinkä¸­çš„å·¥ä½œè¿›ç¨‹ï¼Œé€šå¸¸åœ¨flinkä¸­ä¼šæœ‰å¤šä¸ªTaskManagerè¿è¡Œï¼Œæ¯ä¸€ä¸ªTaskMaganeréƒ½åŒ…å«ä¸€å®šæ•°é‡çš„æ’æ§½ï¼ˆslotsï¼‰. æ’æ§½çš„æ•°é‡é™åˆ¶äº†TaskManagerèƒ½å¤Ÿæ‰§è¡Œçš„ä»»åŠ¡æ•°é‡ï¼›
  
  - å¯åŠ¨ä¹‹åï¼ŒTaskManagerä¼šå‘èµ„æºç®¡ç†å™¨æ³¨å†Œä»–çš„æ’æ§½ï¼Œæ”¶åˆ°èµ„æºç®¡ç†å™¨çš„æŒ‡ä»¤åï¼ŒTaskManagerå°±ä¼šå°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ’æ§½æä¾›ç»™JobManagerè°ƒç”¨ï¼ŒJobManagerå°±å¯ä»¥å‘æ’æ§½åˆ†é…ä»»åŠ¡ï¼ˆtasksï¼‰æ¥æ‰§è¡Œäº†

  - åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªTaskManagerå¯ä»¥è·Ÿå…¶ä»–è¿è¡ŒåŒä¸€åº”ç”¨ç¨‹åºçš„TaskManageräº¤æ¢æ•°æ®ã€‚






## ä»»åŠ¡æäº¤æµç¨‹

<img src="https://oscimg.oschina.net/oscnet/up-89cc1f4eb3aa51db738324a144a29b91db1.png" width=760 height=500>

## ä»»åŠ¡è°ƒåº¦åŸç†

Flink è¿è¡Œæ—¶ç”±ä¸¤ç§ç±»å‹çš„è¿›ç¨‹ç»„æˆï¼šä¸€ä¸ª JobManager å’Œä¸€ä¸ªæˆ–è€…å¤šä¸ª TaskManagerã€‚

<img src="https://ci.apache.org/projects/flink/flink-docs-release-1.13/fig/processes.svg" width=760 height=500> 

Client ä¸æ˜¯è¿è¡Œæ—¶å’Œç¨‹åºæ‰§è¡Œçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç”¨äºå‡†å¤‡æ•°æ®æµå¹¶å°†å…¶å‘é€ç»™ JobManagerã€‚ä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥æ–­å¼€è¿æ¥ï¼ˆåˆ†ç¦»æ¨¡å¼ï¼‰ï¼Œæˆ–ä¿æŒè¿æ¥æ¥æ¥æ”¶è¿›ç¨‹æŠ¥å‘Šï¼ˆé™„åŠ æ¨¡å¼ï¼‰ã€‚å®¢æˆ·ç«¯å¯ä»¥ä½œä¸ºè§¦å‘æ‰§è¡Œ Java/Scala ç¨‹åºçš„ä¸€éƒ¨åˆ†è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œè¿›ç¨‹./bin/flink run ...ä¸­è¿è¡Œã€‚

å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼å¯åŠ¨ JobManager å’Œ TaskManagerï¼šç›´æ¥åœ¨æœºå™¨ä¸Šä½œä¸ºstandalone é›†ç¾¤å¯åŠ¨ã€åœ¨å®¹å™¨ä¸­å¯åŠ¨ã€æˆ–è€…é€šè¿‡YARNæˆ–Mesosç­‰èµ„æºæ¡†æ¶ç®¡ç†å¹¶å¯åŠ¨ã€‚TaskManager è¿æ¥åˆ° JobManagersï¼Œå®£å¸ƒè‡ªå·±å¯ç”¨ï¼Œå¹¶è¢«åˆ†é…å·¥ä½œã€‚

## æ€è€ƒé—®é¢˜ğŸ¤”
> - æ€æ ·å®ç°å¹¶è¡Œè®¡ç®—ï¼Ÿ å¤šçº¿ç¨‹
> - å¹¶è¡Œçš„ä»»åŠ¡ï¼Œéœ€è¦å ç”¨å¤šå°‘soltï¼Ÿ
> - ä¸€ä¸ªæµå¤„ç†ç¨‹åºï¼Œåˆ°åº•åŒ…å«å¤šå°‘ä¸ªä»»åŠ¡ï¼Ÿ



# Tasks å’Œç®—å­é“¾
`å¹¶è¡Œåº¦ï¼ˆParallelismï¼‰`

ä¸€ä¸ªç‰¹å®šç®—å­çš„å­ä»»åŠ¡ï¼ˆsubtaskï¼‰çš„ä¸ªæ•°è¢«ç§°ä¹‹ä¸ºå¹¶è¡Œåº¦ï¼› ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸€ä¸ªStreamçš„å¹¶è¡Œåº¦å°±æ˜¯å…¶æ‰€æœ‰ç®—å­ä¸­æœ€å¤§çš„å¹¶è¡Œåº¦ã€‚
æ•´ä¸ªæµä¹Ÿæœ‰ä¸€ä¸ªå¹¶è¡Œåº¦ï¼Œå°±æ˜¯æ‰€æœ‰ç®—å­æ‰€æœ‰ä»»åŠ¡çš„å¹¶è¡Œåº¦ä¹‹å’Œï¼›
å¯¹äºåˆ†å¸ƒå¼æ‰§è¡Œï¼ŒFlink å°†ç®—å­çš„ subtasks é“¾æ¥æˆ tasksã€‚æ¯ä¸ª task ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚å°†ç®—å­é“¾æ¥æˆ task æ˜¯ä¸ªæœ‰ç”¨çš„ä¼˜åŒ–ï¼šå®ƒå‡å°‘çº¿ç¨‹é—´åˆ‡æ¢ã€ç¼“å†²çš„å¼€é”€ï¼Œå¹¶ä¸”å‡å°‘å»¶è¿Ÿçš„åŒæ—¶å¢åŠ æ•´ä½“ååé‡ã€‚é“¾è¡Œä¸ºæ˜¯å¯ä»¥é…ç½®çš„ï¼›è¯·å‚è€ƒé“¾æ–‡æ¡£ä»¥è·å–è¯¦ç»†ä¿¡æ¯ã€‚
<img src="https://ci.apache.org/projects/flink/flink-docs-release-1.13/fig/tasks_chains.svg" width=760 height=500>


## TaskManager å’Œ Slots

<img src='https://ci.apache.org/projects/flink/flink-docs-release-1.13/fig/tasks_slots.svg' width=800 height=380>