---
title: elasticsearché‡è¦é…ç½®
toc: true
date: 2021-07-05 21:22:32
tags: elasticsearch
categories: [Elasticsearch, Administration and Deployment]
---


è™½ç„¶Elasticsearchä»…éœ€è¦å¾ˆå°‘çš„é…ç½®ï¼Œä½†æœ‰è®¸å¤šè®¾ç½®éœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œå¹¶ä¸”åœ¨è¿›å…¥ç”Ÿäº§ä¹‹å‰ç»å¯¹å¿…é¡»è¿›è¡Œé…ç½®ã€‚

`path.data` å’Œ `path.logs`  
`cluster.name`  
`node.name`  
`bootstrap.memory_lock`  
`network.host`  
`discovery.zen.ping.unicast.hosts`  
`discovery.zen.minimum_master_nodes`   
`path.data` å’Œ `path.logs`  
å¦‚æžœä½¿ç”¨.zipæˆ–.tar.gzå½’æ¡£ï¼Œåˆ™æ•°æ®å’Œæ—¥å¿—ç›®å½•æ˜¯$ES_HOMEçš„å­æ–‡ä»¶å¤¹ã€‚ å¦‚æžœè¿™äº›é‡è¦çš„æ–‡ä»¶å¤¹ä¿ç•™åœ¨å…¶é»˜è®¤ä½ç½®ï¼Œåˆ™å­˜åœ¨å°†Elasticsearchå‡çº§åˆ°æ–°ç‰ˆæœ¬æ—¶è¢«åˆ é™¤çš„é«˜é£Žé™©ã€‚  

åœ¨ç”Ÿäº§ä½¿ç”¨ä¸­ï¼Œè‚¯å®šå¾—æ›´æ”¹æ•°æ®å’Œæ—¥å¿—æ–‡ä»¶å¤¹çš„ä½ç½®ï¼š
```yaml
path:
  logs: /var/log/elasticsearch
  data: /var/data/elasticsearch
```
RPMå’ŒDebianå‘è¡Œç‰ˆå·²ç»ä½¿ç”¨æ•°æ®å’Œæ—¥å¿—çš„è‡ªå®šä¹‰è·¯å¾„ã€‚  

`path.data` è®¾ç½®å¯ä»¥è®¾ç½®ä¸ºå¤šä¸ªè·¯å¾„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è·¯å¾„å°†ç”¨äºŽå­˜å‚¨æ•°æ®ï¼ˆå±žäºŽå•ä¸ªåˆ†ç‰‡çš„æ–‡ä»¶å°†å…¨éƒ¨å­˜å‚¨åœ¨åŒä¸€æ•°æ®è·¯å¾„ä¸Šï¼‰ï¼š
```yaml
path:
  data:
    - /mnt/elasticsearch_1
    - /mnt/elasticsearch_2
    - /mnt/elasticsearch_3
```
## cluster.name
èŠ‚ç‚¹åªèƒ½åœ¨ç¾¤é›†ä¸Žç¾¤é›†ä¸­çš„æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å…±äº«å…¶cluster.nameæ—¶æ‰èƒ½åŠ å…¥ç¾¤é›†ã€‚ é»˜è®¤åç§°ä¸ºelasticsearchï¼Œä½†æ‚¨åº”å°†å…¶æ›´æ”¹ä¸ºæè¿°é›†ç¾¤ç”¨é€”çš„é€‚å½“åç§°ã€‚  
`cluster.name: logging-prod`  
ç¡®ä¿ä¸è¦åœ¨ä¸åŒçš„çŽ¯å¢ƒä¸­é‡å¤ä½¿ç”¨ç›¸åŒçš„é›†ç¾¤åç§°ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´åŠ å…¥é”™è¯¯é›†ç¾¤çš„èŠ‚ç‚¹ã€‚  

## node.name
é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchå°†ä½¿ç”¨éšæœºç”Ÿæˆçš„uuidçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä½œä¸ºèŠ‚ç‚¹idã€‚ è¯·æ³¨æ„ï¼ŒèŠ‚ç‚¹IDæ˜¯æŒä¹…åŒ–çš„ï¼Œå¹¶ä¸”åœ¨èŠ‚ç‚¹é‡æ–°å¯åŠ¨æ—¶ä¸ä¼šæ›´æ”¹ï¼Œå› æ­¤é»˜è®¤èŠ‚ç‚¹åç§°ä¹Ÿä¸ä¼šæ›´æ”¹ã€‚  
é…ç½®ä¸€ä¸ªæ›´æœ‰æ„ä¹‰çš„åç§°æ˜¯å€¼å¾—çš„ï¼Œè¿™æ˜¯é‡å¯èŠ‚ç‚¹åŽä¹Ÿèƒ½ä¸€ç›´ä¿æŒçš„ä¼˜åŠ¿ï¼š  
`node.name: prod-data-2`  
node.nameä¹Ÿå¯ä»¥è®¾ç½®ä¸ºæœåŠ¡å™¨çš„HOSTNAMEï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š  
```yaml
node.name: ${HOSTNAME}
bootstrap.memory_lock
```
æ²¡æœ‰JVMè¢«äº¤æ¢åˆ°ç£ç›˜ä¸Šè¿™äº‹å¯¹äºŽèŠ‚ç‚¹çš„å¥åº·æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ã€‚ä¸€ç§å®žçŽ°æ–¹æ³•æ˜¯å°†bootstrap.memory_lockè®¾ç½®ä¸ºtrueã€‚  
è¦ä½¿æ­¤è®¾ç½®ç”Ÿæ•ˆï¼Œéœ€è¦é¦–å…ˆé…ç½®å…¶ä»–ç³»ç»Ÿè®¾ç½®ã€‚ æœ‰å…³å¦‚ä½•æ­£ç¡®è®¾ç½®å†…å­˜é”å®šçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å¯ç”¨[bootstrap.memory_lock](https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-configuration-memory.html#mlockall)ã€‚  

## network.host
é»˜è®¤æƒ…å†µä¸‹ï¼ŒElasticsearchä»…ä»…ç»‘å®šåœ¨æœ¬åœ°å›žè·¯åœ°å€â€”â€”å¦‚ï¼š127.0.0.1ä¸Ž[::1]ã€‚è¿™åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šè·‘ä¸€ä¸ªå¼€å‘èŠ‚ç‚¹æ˜¯è¶³å¤Ÿçš„ã€‚
æç¤º

äº‹å®žä¸Šï¼Œå¤šä¸ªèŠ‚ç‚¹å¯ä»¥åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šç›¸åŒçš„$ES_HOMEä½ç½®ä¸€åŒè¿è¡Œã€‚è¿™å¯ä»¥ç”¨äºŽæµ‹è¯•Elasticsearchå½¢æˆé›†ç¾¤çš„èƒ½åŠ›,ä½†è¿™ç§é…ç½®æ–¹å¼ä¸æŽ¨èç”¨äºŽç”Ÿäº§çŽ¯å¢ƒã€‚

ä¸ºäº†å°†å…¶å®ƒæœåŠ¡å™¨ä¸Šçš„èŠ‚ç‚¹å½¢æˆä¸€ä¸ªå¯ä»¥ç›¸äº’é€šè®¯çš„é›†ç¾¤ï¼Œä½ çš„èŠ‚ç‚¹å°†ä¸èƒ½ç»‘å®šåœ¨ä¸€ä¸ªå›žè·¯åœ°å€ä¸Šã€‚ è¿™é‡Œæœ‰æ›´å¤šçš„ç½‘è·¯é…ç½®ï¼Œé€šå¸¸ä½ åªéœ€è¦é…ç½®network.hostï¼š  
`network.host: 192.168.1.10`
network.hostä¹Ÿå¯ä»¥é…ç½®æˆä¸€äº›èƒ½è¯†åˆ«çš„ç‰¹æ®Šçš„å€¼ï¼Œè­¬å¦‚ï¼š_local_ã€_siteã€_global_ï¼Œå®ƒä»¬å¯ä»¥ç»“åˆæŒ‡å®š:ip4ä¸Žip6æ¥ä½¿ç”¨ã€‚æ›´å¤šç›¸ä¿¡ä¿¡æ¯è¯·å‚è§ï¼š[ç½‘è·¯é…ç½®](https://aqlu.gitbooks.io/elasticsearch-reference/content/Modules/Network_Settings.html)

é‡è¦ ðŸ‘‡

ä¸€æ—¦ä½ è‡ªå®šä¹‰äº†network.hostçš„é…ç½®ï¼ŒElasticsearchå°†å‡è®¾ä½ å·²ç»ä»Žå¼€å‘æ¨¡å¼è½¬åˆ°äº†ç”Ÿäº§æ¨¡å¼ï¼Œå¹¶å°†å‡çº§ç³»ç»Ÿæ£€æµ‹çš„è­¦å‘Šä¿¡æ¯ä¸ºå¼‚å¸¸ä¿¡æ¯ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ï¼šå¼€å‘æ¨¡å¼vsç”Ÿäº§æ¨¡å¼

## discovery.zen.ping.unicast.hostsï¼ˆå•æ’­å‘çŽ°ï¼‰
å¼€ç®±å³ç”¨ï¼Œæ— éœ€ä»»ä½•ç½‘ç»œé…ç½®ï¼ŒElasticsearchå°†ç»‘å®šåˆ°å¯ç”¨çš„å›žè·¯åœ°å€ï¼Œå¹¶æ‰«æ9300å¹´åˆ°9305çš„ç«¯å£åŽ»è¿žæŽ¥åŒä¸€æœºå™¨ä¸Šçš„å…¶ä»–èŠ‚ç‚¹,è¯•å›¾è¿žæŽ¥åˆ°ç›¸åŒçš„æœåŠ¡å™¨ä¸Šè¿è¡Œçš„å…¶ä»–èŠ‚ç‚¹ã€‚å®ƒæä¾›äº†ä¸éœ€è¦ä»»ä½•é…ç½®å°±èƒ½è‡ªåŠ¨ç»„å»ºé›†ç¾¤çš„ä½“éªŒã€‚  
å½“ä¸Žå…¶å®ƒæœºå™¨ä¸Šçš„èŠ‚ç‚¹è¦å½¢æˆä¸€ä¸ªé›†ç¾¤æ—¶ï¼Œä½ éœ€è¦æä¾›ä¸€ä¸ªåœ¨çº¿ä¸”å¯è®¿é—®çš„èŠ‚ç‚¹åˆ—è¡¨ã€‚åƒå¦‚ä¸‹æ¥é…ç½®ï¼š  
```
discovery.zen.ping.unicast.hosts:
   - 192.168.1.10:9300
   - 192.168.1.11 #â‘ 
   - seeds.mydomain.com #â‘¡
```
â‘  æœªæŒ‡å®šç«¯å£æ—¶ï¼Œå°†ä½¿ç”¨é»˜è®¤çš„`transport.profiles.default.port`å€¼ï¼Œå¦‚æžœæ­¤å€¼ä¹Ÿä¸ºè®¾ç½®åˆ™ä½¿ç”¨`transport.tcp.port`

â‘¡ ä¸»æœºåå°†è¢«å°è¯•è§£æžæˆèƒ½è§£æžçš„å¤šä¸ªIP

## discovery.zen.minimum_master_nodes
ä¸ºé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œé…ç½®discovery-zen-minimum_master_nodeså°†éžå¸¸é‡è¦ï¼Œä»–è§„å®šäº†å¿…é¡»è‡³å°‘è¦æœ‰å¤šå°‘ä¸ªmasterèŠ‚ç‚¹æ‰èƒ½å½¢æˆä¸€ä¸ªé›†ç¾¤ã€‚  
æ²¡æœ‰æ­¤è®¾ç½®æ—¶ï¼Œä¸€ä¸ªé›†ç¾¤åœ¨å‘ç”Ÿç½‘ç»œé—®é¢˜æ˜¯å¯èƒ½ä¼šåˆ†è£‚æˆå¤šä¸ªé›†ç¾¤â€”â€”è„‘è£‚â€”â€”è¿™å°†å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è§ï¼šé€šè¿‡minimum_master_nodesé¿å…è„‘è£‚
ä¸ºé¿å…è„‘è£‚ï¼Œä½ éœ€è¦æ ¹æ®masterèŠ‚ç‚¹æ•°æ¥è®¾ç½®æ³•å®šäººæ•°ï¼š
`(master_eligible_nodes / 2) + 1`
æ¢å¥è¯è¯´ï¼Œå¦‚æžœä½ æœ‰ä¸‰ä¸ªmasterèŠ‚ç‚¹ï¼Œæœ€å°çš„ä¸»èŠ‚ç‚¹æ•°å› è¢«è®¾ç½®ä¸º(3/2)+1æˆ–è€…æ˜¯2
`discovery.zen.minimum_master_nodes: 2`


## å‚è€ƒèµ„æ–™
> - [elastic å®˜æ–¹æ–‡æ¡£](https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-configuration-memory.html#mlockall)
> - [codingdict.com](https://www.codingdict.com/document)
