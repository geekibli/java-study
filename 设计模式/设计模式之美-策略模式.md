---
title: è®¾è®¡æ¨¡å¼ä¹‹ç¾-ç­–ç•¥æ¨¡å¼
toc: true
date: 2021-08-07 20:09:10
tags: è®¾è®¡æ¨¡å¼
categories:
---

# ç­–ç•¥æ¨¡å¼
**ç­–ç•¥æ¨¡å¼**ï¼ˆStrategy Patternï¼‰ä¹Ÿå«åšæ”¿ç­–æ¨¡å¼ï¼ˆPolicy Patternï¼‰,å®ƒæ˜¯å°†å®šä¹‰çš„ç®—æ³•å°è£…èµ·æ¥ï¼Œ
è®©å®ƒä»¬ä¹‹é—´å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œä»è€Œè®©ç®—æ³•çš„å˜åŒ–ä¸å½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„ç”¨æˆ·ï¼›å®ƒå±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§„é¿
if-else/switchç­‰
ç­–ç•¥æ¨¡å¼ä½¿ç”¨çš„é¢å‘å¯¹è±¡çš„ç»§æ‰¿å’Œå¤šæ€æœºåˆ¶ï¼Œä»è€Œå®ç°åŒä¸€è¡Œä¸ºåœ¨ä¸åŒçš„åœºæ™¯ä¸‹å…·å¤‡ä¸åŒçš„å®ç°ï¼›  

## åº”ç”¨
ç­–ç•¥æ¨¡å¼åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­æœ‰å¾ˆå¤šçš„åº”ç”¨ï¼Œå‡¡æ˜¯è®¾è®¡åˆ°é€‰æ‹©çš„åœºæ™¯åŸºæœ¬éƒ½å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥å®ç°ï¼›æ¯”å¦‚è´­ä¹°ä¸€ä¸ªå•†å“é€‰æ‹©æ”¯ä»˜æ–¹å¼ï¼Œæ˜¯é€‰æ‹©é“¶è¡Œå¡è¿˜æ˜¯å¿«æ·æ”¯ä»˜ï¼Œå¾®ä¿¡ï¼Ÿæ”¯ä»˜å®ç­‰ï¼›  

- å‡å¦‚ä¸€ä¸ªç³»ç»Ÿä¸­æœ‰å¾ˆå¤šç±»ï¼Œè€Œå®ƒä»¬çš„åŒºåˆ«ä»…ä»…åœ¨ä¸å®ƒä»¬çš„è¡Œä¸ºä¸åŒï¼›
- ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€çš„ä»å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ï¼›ä¸€äº›å¹³å°å‹äº§å“ä¸­è‚¯å®šä¼šç”¨åˆ°çš„
- éœ€è¦å±è”½ç®—æ³•è§„åˆ™ï¼›

## ç­–ç•¥æ¨¡å¼ç±»å›¾
<img src="https://xcu-oss.oss-cn-beijing.aliyuncs.com/image/gao/up-bcd8e7bee16acac3b254b110a2c2f3796b8.png" style="zoom:50%;" />   
é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œç­–ç•¥æ¨¡å¼ä¸»è¦åŒ…å«3ä¸ªè§’è‰²ï¼š  

- **ä¸Šä¸‹æ–‡è§’è‰²ï¼ˆContextï¼‰**: ç”¨æ¥æ“ä½œç­–ç•¥çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå±è”½é«˜å±‚æ¨¡å—ï¼ˆå®¢æˆ·ç«¯ï¼‰å¯¹ç­–ç•¥/ç®—æ³•çš„ç›´æ¥è®¿é—®ï¼Œå°è£…å¯èƒ½
å­˜åœ¨çš„å˜åŒ–
- **æŠ½è±¡ç­–ç•¥è§’è‰²ï¼ˆIStrategyï¼‰**: è§„å®šç­–ç•¥æˆ–ç®—æ³•çš„è¡Œä¸º    
- **å…·ä½“çš„ç­–ç•¥è§’è‰²ï¼ˆConcreteStrategyï¼‰**: å…·ä½“çš„ç­–ç•¥é€»è¾‘æˆ–ç®—æ³•  

è¿™é‡Œçš„ä¸Šä¸‹æ–‡è§’è‰²ä»…ä»…æ˜¯ä¸€ä¸ªç§°è°“ï¼Œå¤§å®¶åªè¦çŸ¥é“ä»–åœ¨ç­–ç•¥æ¨¡å¼ä¸­çš„ä½œç”¨å°±å¯ä»¥äº†ï¼Œå°±æ˜¯æ¡¥æ¥å®¢æˆ·ç«¯å’Œç­–ç•¥/æ–¹æ³•çš„ä½œç”¨ï¼›  


## ä¸¾ä¸ªä¾‹å­
> èƒŒæ™¯ï¼š ç”µå•†åœºæ™¯ä¸‹ï¼Œç”¨æˆ·è´­ä¹°ä¸€ä¸ªå•†å“ï¼Œæ”¯ä»˜æ—¶å¯ä»¥é€‰æ‹©ä¸€ç§ä¼˜æƒ ç­–ç•¥ï¼Œå¦‚æœæ²¡æœ‰ä¼˜æƒ ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„ç­–ç•¥ï¼Œå³æ— ä»»ä½•ä¼˜æƒ ï¼›  

<img src="https://xcu-oss.oss-cn-beijing.aliyuncs.com/image/gao/up-1f96ebedc89c21db9af9a2ae899918d9fb8.png" style="zoom: 33%;" />  

1ã€ä¸Šé¢ä¸¤å±‚æ˜¯å®šä¹‰çš„ä¸€ä¸ªè¥é”€ç­–ç•¥çš„æ¥å£ï¼Œç„¶åæä¾›ä¸åŒçš„ç­–ç•¥æ¥å®ç°ï¼›  
2ã€ç¬¬ä¸‰å±‚æ˜¯ç­–ç•¥ç”Ÿæˆæ‰€ä½¿ç”¨çš„å·¥å‚å’Œå®¢æˆ·ç«¯è°ƒç”¨ç­–ç•¥ä¸­é—´çš„ä¸Šä¸‹æ–‡ï¼Œæ‰¿æ¥ä¸Šä¸‹ï¼Œæ¡¥æ¥æ¨¡å¼ï¼›  
3ã€æœ€ä¸‹å±‚çš„Demoå¯ä»¥çœ‹æˆæ˜¯å®¢æˆ·ç«¯ï¼›  

### å®šä¹‰ç­–ç•¥æ¥å£ åˆ¶å®šæ ‡å‡†æ–¹æ³•
```java
public interface IPromotionStrategy {
        void doPromote();
    }
```

### CashBackStrategy ç°é‡‘æŠ˜è¿”ç­–ç•¥
```java
public class CashBackStrategy implements IPromotionStrategy{
    @Override
    public void doPromote() {
        System.out.println("ç›´æ¥è¿”ç°");
    }
}
```
### CouponStrategy ä¼˜æƒ åˆ¸ç­–ç•¥
```java
public class CouponStrategy implements IPromotionStrategy{
    // ä¼˜æƒ åˆ¸ç­–ç•¥
    @Override
    public void doPromote() {
        System.out.println("ä½¿ç”¨ä¼˜æƒ åˆ¸æŠµæ‰£");
    }
}
```
### GroupBuyStrategy å›¢è´­ä¼˜æƒ ç­–ç•¥
```java
public class GroupBuyStrategy implements IPromotionStrategy{
    @Override
    public void doPromote() {
        System.out.println("å›¢è´­ 5äººæˆå›¢");
    }
}
```
### EmptyStrategy é»˜è®¤ç­–ç•¥
```java
public class EmptyStrategy implements IPromotionStrategy{
    @Override
    public void doPromote() {
        System.out.println("æ— ä»»ä½•ä¼˜æƒ ");
    }
}
```

### PromoteActivity å®¢æˆ·ç«¯å’Œå…·ä½“ç®—æ³•ä¹‹é—´çš„ä¸Šä¸‹æ–‡ï¼Œç”¨äºæ¡¥æ¥
```java
public class PromoteActivity {

    private IPromotionStrategy promotionStrategy;

    public PromoteActivity(IPromotionStrategy promotionStrategy) {
        this.promotionStrategy = promotionStrategy;
    }

    public void execute(){
        promotionStrategy.doPromote();
    }
}
```

### PromoteStrategyFactory ç­–ç•¥å·¥å‚
```java
public class PromoteStrategyFactory {
    private PromoteStrategyFactory() {
    }
    
    // ç­–ç•¥å®¹å™¨  
    private static Map<String, IPromotionStrategy> promotionStrategyMap = new HashMap<>();
    // é»˜è®¤ç©ºç­–ç•¥-æ²¡æœ‰ä»»ä½•ä¼˜æƒ 
    private static IPromotionStrategy emptyStrategy = new EmptyStrategy();
    // è¿™ä¸ªå¯ä»¥æ”¾åˆ°é…ç½®æ–‡ä»¶æˆ–è€…æ”¾åˆ°æ•°æ®åº“ï¼Œåœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™åŠ è½½åˆ°æœåŠ¡ä¸­å°±å¯ä»¥äº†
    static {
        promotionStrategyMap.put(PromoteKey.CASH_BACK, new CashBackStrategy());
        promotionStrategyMap.put(PromoteKey.COUPON, new CouponStrategy());
        promotionStrategyMap.put(PromoteKey.CROUP_BUY, new GroupBuyStrategy());
    }
    
    // ç®€å•å·¥å‚åˆ›å»ºè¥é”€ç­–ç•¥
    public static IPromotionStrategy createPromoteStrategy(String key) {
        IPromotionStrategy promotionStrategy = promotionStrategyMap.get(key);
        if (promotionStrategy == null) {
            return emptyStrategy;
        }
        return promotionStrategy;
    }

    // æ‰€æœ‰å®šä¹‰å¥½çš„ç­–ç•¥
    private interface PromoteKey {
        String COUPON = "coupon";
        String CROUP_BUY = "groupBuy";
        String CASH_BACK = "cashBack";
    }
    
    // å› ä¸ºç­–ç•¥æ¨¡å¼éœ€è¦ç”¨æˆ·çŸ¥é“æ‰€æœ‰å¯ç”¨çš„ç­–ç•¥ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æš´éœ²ç»™å®¢æˆ·ç«¯
    public static Set<String> getPromoteKeySet() {
        return promotionStrategyMap.keySet();
    }
}
```

### ç­–ç•¥æ¨¡å¼ä¸‹å®¢æˆ·ç«¯å†™æ³•
 ```java
    public static void main(String[] args) {
        String strategy = PromoteStrategyFactory.getPromoteKeySet().stream().findAny().get();
        IPromotionStrategy promoteStrategy = PromoteStrategyFactory.createPromoteStrategy(strategy);
        promoteStrategy.doPromote();
    }
 ```

### éç­–ç•¥æ¨¡å¼ä¸‹å®¢æˆ·ç«¯å†™æ³•
```java
    public static void main(String[] args) {
        String strategy = "å®¢æˆ·é€‰æ‹©çš„ç­–ç•¥";
        IPromotionStrategy promotionStrategy;
        if ("å›¢è´­".equals(strategy)){
             promotionStrategy = new GroupBuyStrategy();
        }else if ("ä¼˜æƒ åˆ¸".equals(strategy)){
            promotionStrategy = new CouponStrategy();
        }else if ("ç°é‡‘æŠ˜è¿”".equals(strategy)){
            promotionStrategy = new CashBackStrategy();
        }else {
            promotionStrategy = new EmptyStrategy();
        }
        promotionStrategy.doPromote();
    }
```

ä»¥ä¸Šçš„å¯¹æ¯”ï¼Œå“ªç§æ–¹å¼æ¯”è¾ƒä¼˜é›…ï¼Œç«‹è§é«˜ä¸‹äº†å§ğŸ˜„ğŸ˜„ğŸ˜„   

## ç­–ç•¥æ¨¡å¼çš„ä¼˜ç‚¹
- **ç­–ç•¥æ¨¡å¼æ˜¯ç¬¦åˆå¼€é—­åŸåˆ™çš„**
- **é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶è½¬ç§»è¯­å¥ if-elseè¯­å¥ã€switchè¯­å¥ç­‰**
- **ä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥æé«˜ç®—æ³•çš„ä¿å¯†æ€§å’Œå®‰å…¨æ€§ï¼ˆå®¢æˆ·ç«¯é€šè¿‡ä¸Šä¸‹æ–‡ç»„å»ºæ¥è°ƒç”¨å…·ä½“çš„ç®—æ³•-æ¡¥æ¥ï¼‰**


## ç­–ç•¥æ¨¡å¼çš„ç¼ºç‚¹
- **å®¢æˆ·ç«¯å¿…é¡»è¦çŸ¥é“å…¨éƒ¨å¯ç”¨çš„ç­–ç•¥ï¼Œç„¶åç”±ç”¨æˆ·å†³å®šä½¿ç”¨é‚£ä¸ªç­–ç•¥ï¼Œå†³å®šæƒåœ¨äºå®¢æˆ·**
- **ä»£ç ä¸­ä¼šäº§ç”Ÿå¾ˆå¤šçš„ç­–ç•¥ç±»ï¼Œå¢åŠ ä»£ç é‡å’Œç³»ç»Ÿçš„ç»´æŠ¤éš¾åº¦**

## ğŸ‘¤ä¸ªäººä½“ä¼š
1ã€ç»“åˆä¸šåŠ¡åœºæ™¯æ¥è®¾è®¡ï¼Œä½“ä¼šè®¾è®¡æ¨¡å¼çš„æ€è·¯ï¼Œå­¦è®¾è®¡æ¨¡å¼æœ€é‡è¦çš„æ˜¯æ€æƒ³ï¼›
2ã€è®¾è®¡æ¨¡å¼ä¸€èˆ¬åœ¨æ¡†æ¶ä¸­ä½“ç°çš„æ¯”è¾ƒå¤šï¼Œå¤§å®¶å¯ä»¥å¤šå­¦ä¹ ä¸€äº›æ¡†æ¶æºç çš„è®¾è®¡ç†å¿µï¼Œå¦‚æœä½ æ˜¯åˆçº§ï¼Œå¯èƒ½ä¸€ä¸‹å­ç†è§£ä¸äº†ï¼Œæ…¢æ…¢ä½“ä¼šå§ï¼Œå½“ä½ å·¥ä½œä¸€æ®µæ—¶é—´ä¹‹åï¼Œè§è¿‡ä¸€äº›å·¥ä¸šç”Ÿäº§çš„é¡¹ç›®ï¼Œçœ‹è¿‡ä¸€äº›ä¼˜ç§€çš„æ¡†æ¶æºç çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸€ä¸ª "æŸ³æš—èŠ±æ˜åˆä¸€æ‘"çš„é˜¶æ®µï¼›
3ã€ä¸¾ä¸ªä¾‹å­ï¼ŒControlleræˆ‘ä»¬éƒ½å†™è¿‡çš„ï¼Œä¸€ä¸ªé¡¹ç›®ä¸­çš„æ¥å£è·¯å¾„æ˜¯å”¯ä¸€çš„ï¼Œé¡¹ç›®å¯åŠ¨çš„æ—¶å€™ï¼Œç”±SpringåŠ è½½åˆ°å®¹å™¨ä¸­ï¼Œ
å½“ç”±è¯·æ±‚è¿›æ¥æ—¶æ˜¯ï¼ŒSpringæ˜¯æ ¹æ®pathæ¥è¿”å›å…·ä½“çš„æ§åˆ¶å™¨ï¼Œä¹Ÿå°±æ˜¯Controllerå…·ä½“çš„æ–¹æ³•ï¼›
4ã€è¿˜æœ‰Comparatoræ¯”è¾ƒå™¨ï¼Œä¸åŒçš„å®¹å™¨å†…éƒ¨åšæ•°æ®æ’åºçš„æ—¶å€™ç”±ä¸åŒçš„å®ç°ï¼Œè¿™ä¹Ÿæ˜¯ç­–ç•¥æ¨¡å¼çš„ä½“ç°ï¼›
5ã€æœ¬æ–‡ä¸­çš„ä¾‹å­è™½ç„¶ç®€å•ï¼Œä½†æ˜¯åŒ…å«äº†ç®€å•å·¥å‚æ¨¡å¼ï¼Œæ¡¥æ¥æ¨¡å¼ï¼Œç­–ç•¥æ¨¡å¼ã€‚ä»»ä½•ä¸€ç§è®¾è®¡æ¨¡å¼éƒ½éš¾ä»¥ç‹¬ç«‹å­˜åœ¨ï¼Œè¿™ä¸ªå¤§å®¶è¦æ³¨æ„ï¼›  
