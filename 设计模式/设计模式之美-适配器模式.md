---
title: è®¾è®¡æ¨¡å¼ä¹‹ç¾-é€‚é…å™¨æ¨¡å¼
toc: true
date: 2021-08-07 20:23:59
tags: è®¾è®¡æ¨¡å¼
categories:
---

# é€‚é…å™¨æ¨¡å¼
é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰åˆå«åšå˜å‹å™¨æ¨¡å¼ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯å°†ä¸€ä¸ªç±»çš„æ¥å£å˜æˆå®¢æˆ·ç«¯æ‰€æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä»è€Œ
ä½¿å¾—åŸæœ¬å› æ¥å£ä¸åŒ¹é…è€Œå¯¼è‡´æ— æ³•åœ¨ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»èƒ½å¤Ÿåœ¨ä¸€èµ·å·¥ä½œï¼Œå±äºç»“æ„æ€§è®¾è®¡æ¨¡å¼çš„ä¸€ç§ï¼›

åœ¨è½¯ä»¶å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼ŒåŸºæœ¬ä¸Šä»»ä½•é—®é¢˜éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸­é—´å±‚è§£å†³ã€‚é€‚é…å™¨æ¨¡å¼å…¶å®å°±æ˜¯ä¸€ä¸ªä¸­é—´å±‚ï¼Œé€‚é…å™¨æ¨¡å¼èµ·ç€
è½¬åŒ–/å§”æ‰˜çš„ä½œç”¨ï¼Œå°†ä¸€ç§æ¥å£è½¬åŒ–ä¸ºä¸¤ä¸€ç§æœåŠ¡åŠŸèƒ½æˆ–éœ€æ±‚çš„æ¥å£ã€‚

ä¸‹é¢ä¸¾ä¸ªä¾‹å­æ¥åˆ†æä¸€ä¸‹ğŸ‘‡  

## ç±»å›¾

<img src="https://xcu-oss.oss-cn-beijing.aliyuncs.com/image/gao/up-785fc6504778eee5c2c820597c0d6e36fbd.png" style="zoom:67%;" /> 
å¦‚å›¾æ˜¯ä¸€ä¸ªé€‚é…å™¨æ¨¡å¼ç±»å›¾æ‰€åœ¨ğŸ‘†  

## ä»£ç 
å®ç°ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šä¸­é€‰æ‹©ï¼Œäºšé©¬é€Šçš„AWS,é˜¿é‡Œçš„OSSç­‰ç­‰å§ï¼Œä½†æ˜¯ä¸åŒçš„å‚å•†æœ‰è‡ªå·±çš„æ ‡å‡†æˆ–è€…API,ä½†æ˜¯åœ¨æˆ‘ä»¬ç³»ç»Ÿä¸­ä½“ç°çš„å°±æ˜¯ä¸€ä¸ªputObjectæ–¹æ³•ï¼Œæ‰€ä»¥éœ€è¦å®šä¹‰ä¸€ä¸ªCloudSDKæ ‡å‡†ï¼Œç„¶åä¸åŒçš„å‚å•†æ¥é€‚é…æˆ‘ä»¬è‡ªå·±çš„æ ‡å‡†ï¼Œåœ¨æˆ‘ä»¬çš„putObjectå’Œä¸‰æ–¹çš„SDKä¸­é—´åŠ ä¸€å±‚é€‚é…å±‚ï¼›
å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œä»…ä»…æ˜¯å®Œæˆæ–‡ä»¶ä¸Šä¼ çš„åŠ¨ä½œï¼Œè‡³äºä½ æœåŠ¡ç«¯åˆ°åº•ä½¿ç”¨äºšé©¬é€Šçš„æœåŠ¡è¿˜æ˜¯é˜¿é‡Œçš„æœåŠ¡ï¼Œå®ƒæ˜¯ä¸careçš„ï¼Œè¿™ä¹Ÿä½“ç°çš„ç­–ç•¥æ¨¡å¼ï¼›  æ‰€ä»¥è¿™ä¸ªä¾‹å­å…¼å¤‡å·¥å‚æ¨¡å¼+ç­–ç•¥æ¨¡å¼+é€‚é…å™¨æ¨¡å¼ï¼›  

###  CloudController 
```java
public class CloudController {
    
    // å¦‚æœæ˜¯Springé¡¹ç›®è¿™é‡Œç›´æ¥æ³¨å…¥å°±å¯ä»¥äº†ï¼Œæ²¡å¿…è¦è¿™ä¹ˆéº»çƒ¦
    public CloudController(CloudService cloudService) {
        this.cloudService = cloudService;
    }

    private CloudService cloudService;
    
    public void uploadFile(String fileName){
        System.out.println("invoke upload file service!" + fileName);
        cloudService.uploadFile(fileName);
    }

    public static void main(String[] args) {
        CloudController cloudController = new CloudController(new CloudService("ali"));
        cloudController.uploadFile("think in java");
    }
}
```

###  CloudService  
```java
public class CloudService {

    private CloudSDK cloudSDK;

    public CloudService(String cloudStorage) {
        // ä½¿ç”¨å·¥å‚æ¥åˆ›å»ºå…·ä½“çš„SDK
        this.cloudSDK = CloudFactory.create(cloudStorage);
    }

    public void uploadFile(String fileName) {
        cloudSDK.putObject(fileName);
    }
}

```

### CloudSDK å®šä¹‰SDKæ ‡å‡†
```java
public interface CloudSDK {
    void putObject(String fileName);
}
```

### AWSSDKAdapter é€‚é…CloudSDKæ ‡å‡†
```java
public class AWSSDKAdapter implements CloudSDK {
    private AWSSDK awssdk;

    public AWSSDKAdapter() {
        this.awssdk = new AWSSDK();
    }

    @Override
    public void putObject(String fileName) {
        awssdk.putObject(fileName);
    }
}
```
### AliSDKAdapteré€‚é…CloudSDKæ ‡å‡†
```java
public class AliSDKAdapter implements CloudSDK {
    private AliSDK aliSDK;

    public AliSDKAdapter() {
        this.aliSDK = new AliSDK();
    }
    
    // è¿™ä¸ªæ–¹æ³•å°±æ˜¯é€‚é…å™¨çš„æ ‡å‡† ä¸ç®¡ä½ çš„ä¸‰æ–¹æœåŠ¡éœ€è¦å¤šå°‘æ¥å£ï¼Œæ˜¯è¦å®ç°äº‘ä¸Šä¼ ï¼Œç»Ÿä¸€é€šè¿‡putObjectè¿™ä¸ªæ¥å£å®ç°å°±å¯ä»¥
    @Override
    public void putObject(String fileName) {
        aliSDK.setBucket();
        aliSDK.uploadFile(fileName);
    }
}
```
### AWSSDK ä¸‰æ–¹SDK 
```java
public class AWSSDK {
    // ä¸€èˆ¬ä»¥JARçš„æ–¹å¼å¼•å…¥åˆ°é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¯èƒ½å»ä¿®æ”¹ä¸‰æ–¹çš„SDK,è¿™æ˜¯å„ä¸ªå‚å•†åˆ¶å®šçš„è‡ªå·±çš„æ ‡å‡†
    public void putObject(String fileName){
        System.out.println("aws upload file " + fileName);
    }
}
```


### AliSDK ä¸‰æ–¹SDK
```java
public class AliSDK {
    // ä¸€èˆ¬ä»¥JARçš„æ–¹å¼å¼•å…¥åˆ°é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¸å¯èƒ½å»ä¿®æ”¹ä¸‰æ–¹çš„SDK,è¿™æ˜¯å„ä¸ªå‚å•†åˆ¶å®šçš„è‡ªå·±çš„æ ‡å‡†
    public void setBucket() {
        System.out.println("Ali oss set bucket!");
    }

    public void uploadFile(String fileName) {
        System.out.println("Ali oss upload file!" + fileName);
    }
}
```

### CloudFactory
```java
public class CloudFactory {
    
    // è¿™é‡Œæ˜¯å†™æ­»äº† ç”Ÿäº§ç¯å¢ƒä¸­å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çš„æ–¹å¼æˆ–è€…å¯åŠ¨åŠ è½½ç­‰ç­‰æ–¹å¼å®ç°ï¼Œæœ‰å¾ˆå¤š
    private static final Map<String, CloudSDK> sdkMap = new HashMap<>();
    
    // æ€»ä¹‹è¦ç¬¦åˆå¼€é—­åŸåˆ™ å¯¹ä¿®æ”¹å…³é—­
    static {
        sdkMap.put("ali", new AliSDKAdapter());
        sdkMap.put("aws", new AWSSDKAdapter());
    }
    
    // é€šè¿‡ä¸åŒçš„ç­–ç•¥ç”Ÿæˆå…·ä½“çš„SDKå®ä¾‹
    public static CloudSDK create(String storage) {
        return sdkMap.get(storage);
    }
}
```

## é€‚é…å™¨å’Œè£…é¥°å™¨æ¨¡å¼çš„åŒºåˆ«

é€‚é…å™¨æ¨¡å¼å’Œè£…é¥°å™¨æ¨¡å¼éƒ½æ˜¯åŒ…è£…å™¨æ¨¡å¼ï¼Œè£…é¥°å™¨æ¨¡å¼å…¶å®æ˜¯ä¸€ç§ç‰¹æ®Šçš„ä»£ç†æ¨¡å¼ï¼›

| å¯¹æ¯”ç»´åº¦ | é€‚é…å™¨æ¨¡å¼                                                   | è£…é¥°å™¨æ¨¡å¼                                                   |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| å½¢å¼     | æ²¡æœ‰å±‚çº§å…³ç³»                                                 | ä¸€ç§éå¸¸ç‰¹åˆ«çš„ä»£ç†æ¨¡å¼ï¼Œå…·æœ‰å±‚çº§å…³ç³»                         |
| å®šä¹‰     | é€‚é…å™¨å’Œè¢«é€‚é…è€…æ²¡æœ‰å¿…ç„¶çš„è”ç³»ï¼Œé€šå¸¸é‡‡ç”¨ç»§æ‰¿æˆ–ä»£ç†çš„æ–¹å¼è¿›è¡ŒåŒ…è£… | è£…é¥°å™¨å’Œè¢«è£…é¥°è€…éƒ½å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œä¸»è¦ç›®çš„æ˜¯æ‰©å±•ä¹‹åä¾æ—§ä¿ç•™OOPå…³ç³» |
| å…³ç³»     | æ²¡æœ‰æ»¡è¶³has-açš„å…³ç³»                                          | æ»¡è¶³is-aå…³ç³»                                                 |
| åŠŸèƒ½     | æ³¨é‡å…¼å®¹ã€è½¬æ¢                                               | æ³¨é‡è¦†ç›–ã€æ‰©å±•                                               |
| è®¾è®¡     | åç½®è€ƒè™‘                                                     | å‰ç½®è€ƒè™‘                                                     |


## é€‚é…å™¨åŠŸèƒ½çš„ä¼˜ç‚¹ âœ…
- **èƒ½æé«˜ç±»çš„é€æ˜æ€§å’Œå¤ç”¨ï¼Œä½†ç°æœ‰çš„ç±»å¤ç”¨ä¸éœ€è¦æ”¹å˜**  
- **é€‚é…å™¨ç±»å’ŒåŸè§’è‰²è§£è€¦ï¼ŒæŠ•ç¨¿ç¨‹åºçš„æ‰©å±•æ€§**
- **åœ¨å¾ˆå¤šä¸šåŠ¡ä¸­ç¬¦åˆå¼€é—­åŸåˆ™**  


## é€‚é…å™¨çš„ç¼ºç‚¹
- **é€‚é…å™¨ç¼–å†™è¿‡ç¨‹éœ€è¦ç»“åˆä¸šåŠ¡åœºæ™¯ç»¼åˆè€ƒè™‘ï¼Œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§**
- **å¢åŠ ä»£ç é˜…è¯»éš¾åº¦ï¼Œé™ä½ä»£ç å¯è¯»æ€§ï¼Œè¿‡å¤šçš„é€‚é…å™¨ä¼šä½¿å¾—ç³»ç»Ÿä»£ç å˜å¾—ç´Šä¹±**

