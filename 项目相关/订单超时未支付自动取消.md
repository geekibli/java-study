# 目标

外卖订单超 30 分钟未支付，则 自动取订单;用户注册成功 15 分钟后，发短信息通知用户等等。这就延时任务 处理场景。
# 思路

- 定时任务轮训数据库
  - 数据库压力大
  - 有延迟，时间不准确
- JDK 延迟队列 DelayQueue
  - 数据存在内存，进程重启数据丢失
  - 数据量大，容易OOM
- redis过期key监听事件
  - redis key过期策略，导致过期时间其实也不是准实时的，存在误差
  - redis事件消费没有确认机制
  - 依赖中间件，增加系统设计复杂性，redis宕机导致服务不可用
- redission分布式延迟队列 RDelayedQueue
  - 强依赖redis中间件
- rocketmq延迟消息
  - 需要业务保障幂等
- robbitmq
  - 依赖中间件
  - 队列消息可能阻塞（如果队头的消息过期时间比较 长，就会导致后面过期的消息无法得到及时消费，造成消息阻塞）