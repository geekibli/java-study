<p data-nodeid="673" class="">ç¼“å­˜ï¼ˆCacheï¼‰æ˜¯æŒ‡å°†ç¨‹åºæˆ–ç³»ç»Ÿä¸­å¸¸ç”¨çš„æ•°æ®å¯¹è±¡å­˜å‚¨åœ¨åƒå†…å­˜è¿™æ ·ç‰¹å®šçš„ä»‹è´¨ä¸­ï¼Œä»¥é¿å…åœ¨æ¯æ¬¡ç¨‹åºè°ƒç”¨æ—¶ï¼Œé‡æ–°åˆ›å»ºæˆ–ç»„ç»‡æ•°æ®æ‰€å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿçš„æ•´ä½“è¿è¡Œé€Ÿåº¦ã€‚</p>
<p data-nodeid="674">ä»¥ç›®å‰çš„ç³»ç»Ÿæ¶æ„æ¥è¯´ï¼Œç”¨æˆ·çš„è¯·æ±‚ä¸€èˆ¬ä¼šå…ˆç»è¿‡ç¼“å­˜ç³»ç»Ÿï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ç›¸å…³çš„æ•°æ®ï¼Œå°±ä¼šåœ¨å…¶ä»–ç³»ç»Ÿä¸­æŸ¥è¯¢åˆ°ç›¸åº”çš„æ•°æ®å¹¶ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œæœ€åè¿”å›ç»™è°ƒç”¨æ–¹ã€‚</p>
<p data-nodeid="675">ç¼“å­˜æ—¢ç„¶å¦‚æ­¤é‡è¦ï¼Œé‚£æœ¬è¯¾æ—¶æˆ‘ä»¬å°±æ¥é‡ç‚¹çœ‹ä¸€ä¸‹ï¼Œåº”è¯¥å¦‚ä½•å®ç°æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ï¼Ÿ</p>
<h3 data-nodeid="676">å…¸å‹å›ç­”</h3>
<p data-nodeid="677">æœ¬åœ°ç¼“å­˜æ˜¯æŒ‡ç¨‹åºçº§åˆ«çš„ç¼“å­˜ç»„ä»¶ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯æœ¬åœ°ç¼“å­˜å’Œåº”ç”¨ç¨‹åºä¼šè¿è¡Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ‰€ä»¥æœ¬åœ°ç¼“å­˜çš„æ“ä½œä¼šéå¸¸å¿«ï¼Œå› ä¸ºåœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…ä¹Ÿæ„å‘³ç€ä¸ä¼šæœ‰ç½‘ç»œä¸Šçš„å»¶è¿Ÿå’Œå¼€é”€ã€‚</p>
<p data-nodeid="678">æœ¬åœ°ç¼“å­˜é€‚ç”¨äºå•èŠ‚ç‚¹éé›†ç¾¤çš„åº”ç”¨åœºæ™¯ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯å¿«ï¼Œç¼ºç‚¹æ˜¯å¤šç¨‹åºæ— æ³•å…±äº«ç¼“å­˜ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼ç”¨æˆ· Session ä¼šè¯ä¿¡æ¯ä¿å­˜ï¼Œç”±äºæ¯æ¬¡ç”¨æˆ·è®¿é—®çš„æœåŠ¡å™¨å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œå¦‚æœä¸èƒ½å…±äº«ç¼“å­˜ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æ¯æ¬¡çš„è¯·æ±‚æ“ä½œéƒ½æœ‰å¯èƒ½è¢«ç³»ç»Ÿé˜»æ­¢ï¼Œå› ä¸ºä¼šè¯ä¿¡æ¯åªä¿å­˜åœ¨æŸä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œå½“è¯·æ±‚æ²¡æœ‰è¢«è½¬å‘åˆ°è¿™å°å­˜å‚¨äº†ç”¨æˆ·ä¿¡æ¯çš„æœåŠ¡å™¨æ—¶ï¼Œå°±ä¼šè¢«è®¤ä¸ºæ˜¯éç™»å½•çš„è¿è§„æ“ä½œã€‚</p>
<p data-nodeid="679">é™¤æ­¤ä¹‹å¤–ï¼Œæ— æ³•å…±äº«ç¼“å­˜å¯èƒ½ä¼šé€ æˆç³»ç»Ÿèµ„æºçš„æµªè´¹ï¼Œè¿™æ˜¯å› ä¸ºæ¯ä¸ªç³»ç»Ÿéƒ½å•ç‹¬ç»´æŠ¤äº†ä¸€ä»½å±äºè‡ªå·±çš„ç¼“å­˜ï¼Œè€ŒåŒä¸€ä»½ç¼“å­˜æœ‰å¯èƒ½è¢«å¤šä¸ªç³»ç»Ÿå•ç‹¬è¿›è¡Œå­˜å‚¨ï¼Œä»è€Œæµªè´¹äº†ç³»ç»Ÿèµ„æºã€‚</p>
<p data-nodeid="680"><strong data-nodeid="762">åˆ†å¸ƒå¼ç¼“å­˜æ˜¯æŒ‡å°†åº”ç”¨ç³»ç»Ÿå’Œç¼“å­˜ç»„ä»¶è¿›è¡Œåˆ†ç¦»çš„ç¼“å­˜æœºåˆ¶</strong>ï¼Œè¿™æ ·å¤šä¸ªåº”ç”¨ç³»ç»Ÿå°±å¯ä»¥å…±äº«ä¸€å¥—ç¼“å­˜æ•°æ®äº†ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯å…±äº«ç¼“å­˜æœåŠ¡å’Œå¯é›†ç¾¤éƒ¨ç½²ï¼Œä¸ºç¼“å­˜ç³»ç»Ÿæä¾›äº†é«˜å¯ç”¨çš„è¿è¡Œç¯å¢ƒï¼Œä»¥åŠç¼“å­˜å…±äº«çš„ç¨‹åºè¿è¡Œæœºåˆ¶ã€‚</p>
<p data-nodeid="681">æœ¬åœ°ç¼“å­˜å¯ä»¥ä½¿ç”¨ EhCache å’Œ Google çš„ Guava æ¥å®ç°ï¼Œè€Œåˆ†å¸ƒå¼ç¼“å­˜å¯ä»¥ä½¿ç”¨ Redis æˆ– Memcached æ¥å®ç°ã€‚</p>
<p data-nodeid="682">ç”±äº Redis æœ¬èº«å°±æ˜¯ç‹¬ç«‹çš„ç¼“å­˜ç³»ç»Ÿï¼Œå› æ­¤å¯ä»¥ä½œä¸ºç¬¬ä¸‰æ–¹æ¥æä¾›å…±äº«çš„æ•°æ®ç¼“å­˜ï¼Œè€Œ Redis çš„åˆ†å¸ƒå¼æ”¯æŒä¸»ä»ã€å“¨å…µå’Œé›†ç¾¤çš„æ¨¡å¼ï¼Œæ‰€ä»¥å®ƒå°±å¯ä»¥æ”¯æŒåˆ†å¸ƒå¼çš„ç¼“å­˜ï¼Œè€Œ Memcached çš„æƒ…å†µä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚</p>
<h3 data-nodeid="683">è€ƒç‚¹åˆ†æ</h3>
<p data-nodeid="684">æœ¬è¯¾æ—¶çš„é¢è¯•é¢˜æ˜¾ç„¶ä¸åªæ˜¯ä¸ºäº†é—®ä½ å¦‚ä½•å®ç°æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜è¿™ä¹ˆç®€å•ï¼Œä¸»è¦è€ƒå¯Ÿçš„æ˜¯ä½ å¯¹ç¼“å­˜ç³»ç»Ÿçš„ç†è§£ï¼Œä»¥åŠå¯¹ç¼“å­˜æœ¬è´¨åŸç†çš„æ´å¯Ÿï¼Œå’Œç¼“å­˜ç›¸å…³çš„é¢è¯•é¢˜è¿˜æœ‰è¿™äº›ï¼š</p>
<ul data-nodeid="685">
<li data-nodeid="686">
<p data-nodeid="687">æ›´åŠ æ·±å…¥çš„è°ˆè°ˆ EhCache å’Œ Guavaã€‚</p>
</li>
<li data-nodeid="688">
<p data-nodeid="689">å¦‚ä½•è‡ªå·±æ‰‹åŠ¨å®ç°ä¸€ä¸ªç¼“å­˜ç³»ç»Ÿï¼Ÿ</p>
</li>
</ul>
<h3 data-nodeid="690">çŸ¥è¯†æ‰©å±•</h3>
<h4 data-nodeid="691">1. EhCache å’Œ Guava çš„ä½¿ç”¨åŠç‰¹ç‚¹åˆ†æ</h4>
<p data-nodeid="692">EhCache æ˜¯ç›®å‰æ¯”è¾ƒæµè¡Œçš„å¼€æºç¼“å­˜æ¡†æ¶ï¼Œæ˜¯ç”¨çº¯ Java è¯­è¨€å®ç°çš„ç®€å•ã€å¿«é€Ÿçš„ Cache ç»„ä»¶ã€‚EhCache æ”¯æŒå†…å­˜ç¼“å­˜å’Œç£ç›˜ç¼“å­˜ï¼Œæ”¯æŒ LRUï¼ˆLeast Recently Usedï¼Œæœ€è¿‘å¾ˆå°‘ä½¿ç”¨ï¼‰ã€LFUï¼ˆLeast Frequently Usedï¼Œæœ€è¿‘ä¸å¸¸è¢«ä½¿ç”¨ï¼‰å’Œ FIFOï¼ˆFirst In First Outï¼Œå…ˆè¿›å…ˆå‡ºï¼‰ç­‰å¤šç§æ·˜æ±°ç®—æ³•ï¼Œå¹¶ä¸”æ”¯æŒåˆ†å¸ƒå¼çš„ç¼“å­˜ç³»ç»Ÿã€‚</p>
<p data-nodeid="693">EhCache æœ€åˆæ˜¯ç‹¬ç«‹çš„æœ¬åœ°ç¼“å­˜æ¡†æ¶ç»„ä»¶ï¼Œåœ¨åæœŸçš„å‘å±•ä¸­ï¼ˆä» 1.2 ç‰ˆï¼‰å¼€å§‹æ”¯æŒåˆ†å¸ƒå¼ç¼“å­˜ï¼Œåˆ†å¸ƒå¼ç¼“å­˜ä¸»è¦æ”¯æŒ RMIã€JGroupsã€EhCache Server ç­‰æ–¹å¼ã€‚</p>
<p data-nodeid="694"><strong data-nodeid="778">LRU å’Œ LFU çš„åŒºåˆ«</strong></p>
<p data-nodeid="695">LRU ç®—æ³•æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œæ¯”å¦‚è¯´å¾ˆä¹…æ²¡æœ‰ä½¿ç”¨çš„ä¸€ä¸ªé”®å€¼ï¼Œå¦‚æœæœ€è¿‘è¢«è®¿é—®äº†ä¸€æ¬¡ï¼Œé‚£ä¹ˆå³ä½¿å®ƒæ˜¯ä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„ç¼“å­˜ï¼Œå®ƒä¹Ÿä¸ä¼šè¢«æ·˜æ±°ï¼›è€Œ LFU ç®—æ³•è§£å†³äº†å¶å°”è¢«è®¿é—®ä¸€æ¬¡ä¹‹åï¼Œæ•°æ®å°±ä¸ä¼šè¢«æ·˜æ±°çš„é—®é¢˜ï¼Œå®ƒæ˜¯æ ¹æ®æ€»è®¿é—®æ¬¡æ•°æ¥æ·˜æ±°æ•°æ®çš„ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯â€œå¦‚æœæ•°æ®è¿‡å»è¢«è®¿é—®å¤šæ¬¡ï¼Œé‚£ä¹ˆå°†æ¥å®ƒè¢«è®¿é—®æ¬¡æ•°ä¹Ÿä¼šæ¯”è¾ƒå¤šâ€ã€‚å› æ­¤ LFU å¯ä»¥ç†è§£ä¸ºæ¯” LRU æ›´åŠ åˆç†çš„æ·˜æ±°ç®—æ³•ã€‚</p>
<p data-nodeid="696"><strong data-nodeid="783">EhCache åŸºç¡€ä½¿ç”¨</strong></p>
<p data-nodeid="697">é¦–å…ˆï¼Œéœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ  EhCache æ¡†æ¶ï¼Œå¦‚æœä¸º Maven é¡¹ç›®ï¼Œåˆ™éœ€è¦åœ¨ pom.xml ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</p>
<pre class="lang-html" data-nodeid="698"><code data-language="html"><span class="hljs-comment">&lt;!--&nbsp;https://mvnrepository.com/artifact/org.ehcache/ehcache&nbsp;--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p data-nodeid="699">æ— é…ç½®å‚æ•°çš„ EhCache 3.x ä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="700"><code data-language="java"><span class="hljs-keyword">import</span>&nbsp;org.ehcache.Cache;
<span class="hljs-keyword">import</span>&nbsp;org.ehcache.CacheManager;
<span class="hljs-keyword">import</span>&nbsp;org.ehcache.config.builders.CacheConfigurationBuilder;
<span class="hljs-keyword">import</span>&nbsp;org.ehcache.config.builders.CacheManagerBuilder;
<span class="hljs-keyword">import</span>&nbsp;org.ehcache.config.builders.ResourcePoolsBuilder;

<span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">EhCacheExample</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;args)</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;åˆ›å»ºç¼“å­˜ç®¡ç†å™¨</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CacheManager&nbsp;cacheManager&nbsp;=&nbsp;CacheManagerBuilder.newCacheManagerBuilder().build();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;åˆå§‹åŒ–&nbsp;EhCache</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cacheManager.init();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;åˆ›å»ºç¼“å­˜ï¼ˆå­˜å‚¨å™¨ï¼‰</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&lt;String,&nbsp;String&gt;&nbsp;myCache&nbsp;=&nbsp;cacheManager.createCache(<span class="hljs-string">"MYCACHE"</span>,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CacheConfigurationBuilder.newCacheConfigurationBuilder(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String.class,&nbsp;String.class,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ResourcePoolsBuilder.heap(<span class="hljs-number">10</span>)));&nbsp;<span class="hljs-comment">//&nbsp;è®¾ç½®ç¼“å­˜çš„æœ€å¤§å®¹é‡</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è®¾ç½®ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;myCache.put(<span class="hljs-string">"key"</span>,&nbsp;<span class="hljs-string">"Hello,Java."</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è¯»å–ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;value&nbsp;=&nbsp;myCache.get(<span class="hljs-string">"key"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è¾“å‡ºç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(value);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;å…³é—­ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cacheManager.close();
&nbsp;&nbsp;&nbsp;&nbsp;}
}
</code></pre>
<p data-nodeid="701">å…¶ä¸­ï¼š</p>
<ul data-nodeid="702">
<li data-nodeid="703">
<p data-nodeid="704">CacheManagerï¼šæ˜¯ç¼“å­˜ç®¡ç†å™¨ï¼Œå¯ä»¥é€šè¿‡å•ä¾‹æˆ–è€…å¤šä¾‹çš„æ–¹å¼åˆ›å»ºï¼Œä¹Ÿæ˜¯ Ehcache çš„å…¥å£ç±»ï¼›</p>
</li>
<li data-nodeid="705">
<p data-nodeid="706">Cacheï¼šæ¯ä¸ª CacheManager å¯ä»¥ç®¡ç†å¤šä¸ª Cacheï¼Œæ¯ä¸ª Cache å¯ä»¥é‡‡ç”¨ hash çš„æ–¹å¼å­˜å‚¨å¤šä¸ªå…ƒç´ ã€‚</p>
</li>
</ul>
<p data-nodeid="707">å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>
<img src="https://s0.lgstatic.com/i/image3/M01/0C/17/Ciqah16NsS2AUntaAAA6FUv7b_I176.png" alt="" data-nodeid="792"></p>
<p data-nodeid="708">æ›´å¤šä½¿ç”¨æ–¹æ³•ï¼Œ<a href="http://www.ehcache.org/documentation/3.8/getting-started.html" data-nodeid="796">è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p data-nodeid="709">EhCache çš„ç‰¹ç‚¹æ˜¯ï¼Œå®ƒä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”æœ¬èº«çš„ jar åŒ…ä¸æ˜¯ä¸å¤§ï¼Œç®€å•çš„é…ç½®ä¹‹åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚EhCache çš„ä½¿ç”¨æ¯”è¾ƒçµæ´»ï¼Œå®ƒæ”¯æŒå¤šç§ç¼“å­˜ç­–ç•¥çš„é…ç½®ï¼Œå®ƒåŒæ—¶æ”¯æŒå†…å­˜å’Œç£ç›˜ç¼“å­˜ä¸¤ç§æ–¹å¼ï¼Œåœ¨ EhCache 1.2 ä¹‹åä¹Ÿå¼€å§‹æ”¯æŒåˆ†å¸ƒå¼ç¼“å­˜äº†ã€‚</p>
<p data-nodeid="710">Guava Cache æ˜¯ Google å¼€æºçš„ Guava é‡Œçš„ä¸€ä¸ªå­åŠŸèƒ½ï¼Œå®ƒæ˜¯ä¸€ä¸ªå†…å­˜å‹çš„æœ¬åœ°ç¼“å­˜å®ç°æ–¹æ¡ˆï¼Œæä¾›äº†çº¿ç¨‹å®‰å…¨çš„ç¼“å­˜æ“ä½œæœºåˆ¶ã€‚</p>
<p data-nodeid="711">Guava Cache çš„æ¶æ„è®¾è®¡çµæ„Ÿæ¥æºäº ConcurrentHashMapï¼Œå®ƒä½¿ç”¨äº†å¤šä¸ª segments æ–¹å¼çš„ç»†ç²’åº¦é”ï¼Œåœ¨ä¿è¯çº¿ç¨‹å®‰å…¨çš„åŒæ—¶ï¼Œæ”¯æŒäº†é«˜å¹¶å‘çš„ä½¿ç”¨åœºæ™¯ã€‚Guava Cache ç±»ä¼¼äº Map é›†åˆçš„æ–¹å¼å¯¹é”®å€¼å¯¹è¿›è¡Œæ“ä½œï¼Œåªä¸è¿‡å¤šäº†è¿‡æœŸæ·˜æ±°ç­‰å¤„ç†é€»è¾‘ã€‚</p>
<p data-nodeid="712">åœ¨ä½¿ç”¨ Guava Cache ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåœ¨ pom.xml ä¸­æ·»åŠ  Guava æ¡†æ¶ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<pre class="lang-html" data-nodeid="713"><code data-language="html"><span class="hljs-comment">&lt;!--&nbsp;https://mvnrepository.com/artifact/com.google.guava/guava&nbsp;--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.google.guava<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>guava<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>28.2-jre<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p data-nodeid="714">Guava Cache çš„åˆ›å»ºæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ LoadingCacheï¼Œå¦ä¸€ç§æ˜¯ Callableï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="715"><code data-language="java"><span class="hljs-keyword">import</span>&nbsp;com.google.common.cache.*;

<span class="hljs-keyword">import</span>&nbsp;java.util.concurrent.Callable;
<span class="hljs-keyword">import</span>&nbsp;java.util.concurrent.ExecutionException;
<span class="hljs-keyword">import</span>&nbsp;java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">GuavaExample</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;args)</span>&nbsp;<span class="hljs-keyword">throws</span>&nbsp;ExecutionException&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;åˆ›å»ºæ–¹å¼ä¸€ï¼šLoadingCache</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoadingCache&lt;String,&nbsp;String&gt;&nbsp;loadCache&nbsp;=&nbsp;CacheBuilder.newBuilder()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;å¹¶å‘çº§åˆ«è®¾ç½®ä¸º&nbsp;5ï¼Œæ˜¯æŒ‡å¯ä»¥åŒæ—¶å†™ç¼“å­˜çš„çº¿ç¨‹æ•°</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.concurrencyLevel(<span class="hljs-number">5</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è®¾ç½®&nbsp;8&nbsp;ç§’é’Ÿè¿‡æœŸ</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.expireAfterWrite(<span class="hljs-number">8</span>,&nbsp;TimeUnit.SECONDS)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//è®¾ç½®ç¼“å­˜å®¹å™¨çš„åˆå§‹å®¹é‡ä¸º&nbsp;10</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.initialCapacity(<span class="hljs-number">10</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è®¾ç½®ç¼“å­˜æœ€å¤§å®¹é‡ä¸º&nbsp;100ï¼Œè¶…è¿‡ä¹‹åå°±ä¼šæŒ‰ç…§&nbsp;LRU&nbsp;ç®—æ³•ç§»é™¤ç¼“å­˜é¡¹</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.maximumSize(<span class="hljs-number">100</span>)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è®¾ç½®è¦ç»Ÿè®¡ç¼“å­˜çš„å‘½ä¸­ç‡</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.recordStats()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è®¾ç½®ç¼“å­˜çš„ç§»é™¤é€šçŸ¥</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.removalListener(<span class="hljs-keyword">new</span>&nbsp;RemovalListener&lt;Object,&nbsp;Object&gt;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">onRemoval</span><span class="hljs-params">(RemovalNotification&lt;Object,&nbsp;Object&gt;&nbsp;notification)</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(notification.getKey()&nbsp;+&nbsp;<span class="hljs-string">"&nbsp;was&nbsp;removed,&nbsp;cause&nbsp;is&nbsp;"</span>&nbsp;+&nbsp;notification.getCause());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;æŒ‡å®š&nbsp;CacheLoaderï¼Œç¼“å­˜ä¸å­˜åœ¨æ—¶ï¼Œå¯è‡ªåŠ¨åŠ è½½ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build(
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">new</span>&nbsp;CacheLoader&lt;String,&nbsp;String&gt;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@Override</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;String&nbsp;<span class="hljs-title">load</span><span class="hljs-params">(String&nbsp;key)</span>&nbsp;<span class="hljs-keyword">throws</span>&nbsp;Exception&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è‡ªåŠ¨åŠ è½½ç¼“å­˜çš„ä¸šåŠ¡</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-string">"cache-value:"</span>&nbsp;+&nbsp;key;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è®¾ç½®ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;loadCache.put(<span class="hljs-string">"c1"</span>,&nbsp;<span class="hljs-string">"Hello,&nbsp;c1."</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;æŸ¥è¯¢ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;val&nbsp;=&nbsp;loadCache.get(<span class="hljs-string">"c1"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(val);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;æŸ¥è¯¢ä¸å­˜åœ¨çš„ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;noval&nbsp;=&nbsp;loadCache.get(<span class="hljs-string">"noval"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(noval);

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;åˆ›å»ºæ–¹å¼äºŒï¼šCallable</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cache&lt;String,&nbsp;String&gt;&nbsp;cache&nbsp;=&nbsp;CacheBuilder.newBuilder()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.maximumSize(<span class="hljs-number">2</span>)&nbsp;<span class="hljs-comment">//&nbsp;è®¾ç½®ç¼“å­˜æœ€å¤§é•¿åº¦</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.build();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è®¾ç½®ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.put(<span class="hljs-string">"k1"</span>,&nbsp;<span class="hljs-string">"Hello,&nbsp;k1."</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;æŸ¥è¯¢ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;value&nbsp;=&nbsp;cache.get(<span class="hljs-string">"k1"</span>,&nbsp;<span class="hljs-keyword">new</span>&nbsp;Callable&lt;String&gt;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@Override</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;String&nbsp;<span class="hljs-title">call</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;ç¼“å­˜ä¸å­˜åœ¨æ—¶ï¼Œæ‰§è¡Œ</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-string">"nil"</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è¾“å‡ºç¼“å­˜å€¼</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(value);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;æŸ¥è¯¢ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;nokey&nbsp;=&nbsp;cache.get(<span class="hljs-string">"nokey"</span>,&nbsp;<span class="hljs-keyword">new</span>&nbsp;Callable&lt;String&gt;()&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@Override</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;String&nbsp;<span class="hljs-title">call</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;ç¼“å­˜ä¸å­˜åœ¨æ—¶ï¼Œæ‰§è¡Œ</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-string">"nil"</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è¾“å‡ºç¼“å­˜å€¼</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(nokey);
&nbsp;&nbsp;&nbsp;&nbsp;}
}
</code></pre>
<p data-nodeid="716">ä»¥ä¸Šç¨‹åºçš„æ‰§è¡Œç»“æœä¸ºï¼š</p>
<pre class="lang-java" data-nodeid="717"><code data-language="java">Hello,&nbsp;c1.
cache-value:noval
Hello,&nbsp;k1.
nil
</code></pre>
<p data-nodeid="718">å¯ä»¥çœ‹å‡º Guava Cache ä½¿ç”¨äº†ç¼–ç¨‹å¼çš„ build ç”Ÿæˆå™¨è¿›è¡Œåˆ›å»ºå’Œç®¡ç†ï¼Œè®©ä½¿ç”¨è€…å¯ä»¥æ›´åŠ çµæ´»åœ°æ“çºµä»£ç ï¼Œå¹¶ä¸” Guava Cache æä¾›äº†çµæ´»å¤šæ ·çš„ä¸ªæ€§åŒ–é…ç½®ï¼Œä»¥é€‚åº”å„ç§ä½¿ç”¨åœºæ™¯ã€‚</p>
<h4 data-nodeid="719">2. æ‰‹åŠ¨å®ç°ä¸€ä¸ªç¼“å­˜ç³»ç»Ÿ</h4>
<p data-nodeid="720">ä¸Šé¢æˆ‘ä»¬è®²äº†é€šè¿‡ EhCache å’Œ Guava å®ç°ç¼“å­˜çš„æ–¹å¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹è‡ªå·±å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ªç¼“å­˜ç³»ç»Ÿï¼Œå½“ç„¶è¿™é‡Œè¯´çš„æ˜¯è‡ªå·±æ‰‹åŠ¨å®ç°ä¸€ä¸ªæœ¬åœ°ç¼“å­˜ã€‚</p>
<p data-nodeid="721">è¦è‡ªå®šä¹‰ä¸€ä¸ªç¼“å­˜ï¼Œé¦–å…ˆè¦è€ƒè™‘çš„æ˜¯æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Map é›†åˆä¸­çš„ HashMapã€Hashtable æˆ– ConcurrentHashMap æ¥å®ç°ï¼Œéå¹¶å‘æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ HashMapï¼Œå¹¶å‘æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ Hashtable æˆ– ConcurrentHashMapï¼Œç”±äº ConcurrentHashMap çš„æ€§èƒ½æ¯” Hashtable çš„é«˜ï¼Œå› æ­¤åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹æˆ‘ä»¬å¯ä»¥å€¾å‘äºé€‰æ‹© ConcurrentHashMapï¼Œä¸è¿‡å®ƒä»¬å¯¹å…ƒç´ çš„æ“ä½œéƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p>
<p data-nodeid="722">é€‰å®šäº†æ•°æ®ç±»å‹ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ç¼“å­˜è¿‡æœŸå’Œç¼“å­˜æ·˜æ±°ç­‰é—®é¢˜ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å€Ÿé‰´ Redis å¯¹å¾…è¿‡æœŸé”®çš„å¤„ç†ç­–ç•¥ã€‚</p>
<p data-nodeid="723">ç›®å‰æ¯”è¾ƒå¸¸è§çš„è¿‡æœŸç­–ç•¥æœ‰ä»¥ä¸‹ä¸‰ç§ï¼š</p>
<ul data-nodeid="724">
<li data-nodeid="725">
<p data-nodeid="726">å®šæ—¶åˆ é™¤</p>
</li>
<li data-nodeid="727">
<p data-nodeid="728">æƒ°æ€§åˆ é™¤</p>
</li>
<li data-nodeid="729">
<p data-nodeid="730">å®šæœŸåˆ é™¤</p>
</li>
</ul>
<p data-nodeid="731"><strong data-nodeid="819">å®šæ—¶åˆ é™¤</strong>æ˜¯æŒ‡åœ¨è®¾ç½®é”®å€¼çš„è¿‡æœŸæ—¶é—´æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå®šæ—¶äº‹ä»¶ï¼Œå½“åˆ°è¾¾è¿‡æœŸæ—¶é—´åï¼Œäº‹ä»¶å¤„ç†å™¨ä¼šæ‰§è¡Œåˆ é™¤è¿‡æœŸé”®çš„æ“ä½œã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯å¯ä»¥åŠæ—¶çš„é‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œç¼ºç‚¹æ˜¯éœ€è¦å¼€å¯å¤šä¸ªå»¶è¿Ÿæ‰§è¡Œäº‹ä»¶æ¥å¤„ç†æ¸…é™¤ä»»åŠ¡ï¼Œè¿™æ ·å°±ä¼šé€ æˆå¤§é‡ä»»åŠ¡äº‹ä»¶å †ç§¯ï¼Œå ç”¨äº†å¾ˆå¤šç³»ç»Ÿèµ„æºã€‚</p>
<p data-nodeid="732"><strong data-nodeid="824">æƒ°æ€§åˆ é™¤</strong>ä¸ä¼šä¸»åŠ¨åˆ é™¤è¿‡æœŸé”®ï¼Œè€Œæ˜¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶æ‰ä¼šåˆ¤æ–­æ­¤å€¼æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤é”®å€¼ï¼Œå¦åˆ™å°±è¿”å›æ­£å¸¸å€¼ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯åªä¼šå ç”¨å°‘é‡çš„ç³»ç»Ÿèµ„æºï¼Œç¼ºç‚¹æ˜¯æ¸…é™¤ä¸å¤ŸåŠæ—¶ï¼Œä¼šé€ æˆä¸€å®šçš„ç©ºé—´æµªè´¹ã€‚</p>
<p data-nodeid="733"><strong data-nodeid="829">å®šæœŸåˆ é™¤</strong>æ˜¯æŒ‡æ¯éš”ä¸€æ®µæ—¶é—´æ£€æŸ¥ä¸€æ¬¡æ•°æ®åº“ï¼Œéšæœºåˆ é™¤ä¸€äº›è¿‡æœŸé”®å€¼ã€‚</p>
<p data-nodeid="734">Redis ä½¿ç”¨çš„æ˜¯å®šæœŸåˆ é™¤å’Œæƒ°æ€§åˆ é™¤è¿™ä¸¤ç§ç­–ç•¥ï¼Œæˆ‘ä»¬æœ¬è¯¾æ—¶ä¹Ÿä¼šå‚ç…§è¿™ä¸¤ç§ç­–ç•¥ã€‚</p>
<p data-nodeid="735">å…ˆæ¥è¯´ä¸€ä¸‹è‡ªå®šä¹‰ç¼“å­˜çš„å®ç°æ€è·¯ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªå­˜æ”¾ç¼“å­˜å€¼çš„å®ä½“ç±»ï¼Œè¿™ä¸ªç±»é‡ŒåŒ…å«äº†ç¼“å­˜çš„ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚ç¼“å­˜çš„ key å’Œ valueï¼Œç¼“å­˜çš„å­˜å…¥æ—¶é—´ã€æœ€åä½¿ç”¨æ—¶é—´å’Œå‘½ä¸­æ¬¡æ•°ï¼ˆé¢„ç•™å­—æ®µï¼Œç”¨äºæ”¯æŒ LFU ç¼“å­˜æ·˜æ±°ï¼‰ï¼Œå†ä½¿ç”¨ ConcurrentHashMap ä¿å­˜ç¼“å­˜çš„ key å’Œ value å¯¹è±¡ï¼ˆç¼“å­˜å€¼çš„å®ä½“ç±»ï¼‰ï¼Œç„¶åå†æ–°å¢ä¸€ä¸ªç¼“å­˜æ“ä½œçš„å·¥å…·ç±»ï¼Œç”¨äºæ·»åŠ å’Œåˆ é™¤ç¼“å­˜ï¼Œæœ€åå†ç¼“å­˜å¯åŠ¨æ—¶ï¼Œå¼€å¯ä¸€ä¸ªæ— é™å¾ªç¯çš„çº¿ç¨‹ç”¨äºæ£€æµ‹å¹¶åˆ é™¤è¿‡æœŸçš„ç¼“å­˜ï¼Œå®ç°ä»£ç å¦‚ä¸‹ã€‚</p>
<p data-nodeid="736">é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªç¼“å­˜å€¼å®ä½“ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-java te-preview-highlight" data-nodeid="4885"><code data-language="java"><span class="hljs-keyword">import</span> lombok.Getter;
<span class="hljs-keyword">import</span> lombok.Setter;

<span class="hljs-comment">/**
 * ç¼“å­˜å®ä½“ç±»
 */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@Setter</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">Comparable</span>&lt;<span class="hljs-title">MyCache</span>&gt; </span>{
    <span class="hljs-comment">// ç¼“å­˜é”®</span>
    <span class="hljs-keyword">private</span> Object key;
    <span class="hljs-comment">// ç¼“å­˜å€¼</span>
    <span class="hljs-keyword">private</span> Object value;
    <span class="hljs-comment">// æœ€åè®¿é—®æ—¶é—´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> lastTime;
    <span class="hljs-comment">// åˆ›å»ºæ—¶é—´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> writeTime;
    <span class="hljs-comment">// å­˜æ´»æ—¶é—´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">long</span> expireTime;
    <span class="hljs-comment">// å‘½ä¸­æ¬¡æ•°</span>
    <span class="hljs-keyword">private</span> Integer hitCount;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">compareTo</span><span class="hljs-params">(MyCache o)</span> </span>{
        <span class="hljs-keyword">return</span> hitCount.compareTo(o.hitCount);
    }
}
</code></pre>













<p data-nodeid="738">ç„¶åå®šä¹‰ä¸€ä¸ªå…¨å±€ç¼“å­˜å¯¹è±¡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="739"><code data-language="java"><span class="hljs-keyword">import</span>&nbsp;java.util.concurrent.ConcurrentHashMap;
<span class="hljs-keyword">import</span>&nbsp;java.util.concurrent.ConcurrentMap;

<span class="hljs-comment">/**
&nbsp;*&nbsp;Cache&nbsp;å…¨å±€ç±»
&nbsp;*/</span>
<span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">CacheGlobal</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;å…¨å±€ç¼“å­˜å¯¹è±¡</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;ConcurrentMap&lt;String,&nbsp;MyCache&gt;&nbsp;concurrentMap&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;ConcurrentHashMap&lt;&gt;();
}
</code></pre>
<p data-nodeid="740">å®šä¹‰è¿‡æœŸç¼“å­˜æ£€æµ‹ç±»çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="741"><code data-language="java"><span class="hljs-keyword">import</span>&nbsp;java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
&nbsp;*&nbsp;è¿‡æœŸç¼“å­˜æ£€æµ‹çº¿ç¨‹
&nbsp;*/</span>
<span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">ExpireThread</span>&nbsp;<span class="hljs-keyword">implements</span>&nbsp;<span class="hljs-title">Runnable</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-meta">@Override</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">run</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">while</span>&nbsp;(<span class="hljs-keyword">true</span>)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;æ¯åç§’æ£€æµ‹ä¸€æ¬¡</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TimeUnit.SECONDS.sleep(<span class="hljs-number">10</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;ç¼“å­˜æ£€æµ‹å’Œæ¸…é™¤çš„æ–¹æ³•</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expireCache();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="hljs-keyword">catch</span>&nbsp;(Exception&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;ç¼“å­˜æ£€æµ‹å’Œæ¸…é™¤çš„æ–¹æ³•
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">expireCache</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"æ£€æµ‹ç¼“å­˜æ˜¯å¦è¿‡æœŸç¼“å­˜"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">for</span>&nbsp;(String&nbsp;key&nbsp;:&nbsp;CacheGlobal.concurrentMap.keySet())&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;MyCache&nbsp;cache&nbsp;=&nbsp;CacheGlobal.concurrentMap.get(key);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;å½“å‰æ—¶é—´&nbsp;-&nbsp;å†™å…¥æ—¶é—´</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">long</span>&nbsp;timoutTime&nbsp;=&nbsp;System.currentTimeMillis() - cache.getWriteTime();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">if</span>&nbsp;(cache.getExpireTime()&nbsp;&gt;&nbsp;timoutTime)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;æ²¡è¿‡æœŸ</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">continue</span>;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;æ¸…é™¤è¿‡æœŸç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CacheGlobal.concurrentMap.remove(key);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
}
</code></pre>
<p data-nodeid="742">æ¥ç€ï¼Œæˆ‘ä»¬è¦æ–°å¢ä¸€ä¸ªç¼“å­˜æ“ä½œçš„å·¥å…·ç±»ï¼Œç”¨äºæŸ¥è¯¢å’Œå­˜å…¥ç¼“å­˜ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="743"><code data-language="java"><span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;

<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * ç¼“å­˜æ“ä½œå·¥å…·ç±»
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CacheUtils</span> </span>{

    <span class="hljs-comment">/**
     * æ·»åŠ ç¼“å­˜
     * <span class="hljs-doctag">@param</span> key
     * <span class="hljs-doctag">@param</span> value
     * <span class="hljs-doctag">@param</span> expire
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">put</span><span class="hljs-params">(String key, Object value, <span class="hljs-keyword">long</span> expire)</span> </span>{
        <span class="hljs-comment">// éç©ºåˆ¤æ–­ï¼Œå€ŸåŠ© commons-lang3</span>
        <span class="hljs-keyword">if</span> (StringUtils.isBlank(key)) <span class="hljs-keyword">return</span>;
        <span class="hljs-comment">// å½“ç¼“å­˜å­˜åœ¨æ—¶ï¼Œæ›´æ–°ç¼“å­˜</span>
        <span class="hljs-keyword">if</span> (CacheGlobal.concurrentMap.containsKey(key)) {
            MyCache cache = CacheGlobal.concurrentMap.get(key);
            cache.setHitCount(cache.getHitCount() + <span class="hljs-number">1</span>);
            cache.setWriteTime(System.currentTimeMillis());
            cache.setLastTime(System.currentTimeMillis());
            cache.setExpireTime(expire);
            cache.setValue(value);
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-comment">// åˆ›å»ºç¼“å­˜</span>
        MyCache cache = <span class="hljs-keyword">new</span> MyCache();
        cache.setKey(key);
        cache.setValue(value);
        cache.setWriteTime(System.currentTimeMillis());
        cache.setLastTime(System.currentTimeMillis());
        cache.setHitCount(<span class="hljs-number">1</span>);
        cache.setExpireTime(expire);
        CacheGlobal.concurrentMap.put(key, cache);
    }

    <span class="hljs-comment">/**
     * è·å–ç¼“å­˜
     * <span class="hljs-doctag">@param</span> key
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">get</span><span class="hljs-params">(String key)</span> </span>{
        <span class="hljs-comment">// éç©ºåˆ¤æ–­</span>
        <span class="hljs-keyword">if</span> (StringUtils.isBlank(key)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        <span class="hljs-comment">// å­—å…¸ä¸­ä¸å­˜åœ¨</span>
        <span class="hljs-keyword">if</span> (CacheGlobal.concurrentMap.isEmpty()) <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">if</span> (!CacheGlobal.concurrentMap.containsKey(key)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        MyCache cache = CacheGlobal.concurrentMap.get(key);
        <span class="hljs-keyword">if</span> (cache == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        <span class="hljs-comment">// æƒ°æ€§åˆ é™¤ï¼Œåˆ¤æ–­ç¼“å­˜æ˜¯å¦è¿‡æœŸ</span>
        <span class="hljs-keyword">long</span> timoutTime = System.currentTimeMillis() - cache.getWriteTime();
        <span class="hljs-comment">// ç¼“å­˜è¿‡æœŸ</span>
        <span class="hljs-keyword">if</span> (cache.getExpireTime() &lt;= timoutTime) {
            <span class="hljs-comment">// æ¸…é™¤è¿‡æœŸç¼“å­˜</span>
            CacheGlobal.concurrentMap.remove(key);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }
        cache.setHitCount(cache.getHitCount() + <span class="hljs-number">1</span>);
        cache.setLastTime(System.currentTimeMillis());
        <span class="hljs-keyword">return</span> cache.getValue();
    }
}
</code></pre>
<p data-nodeid="744">æœ€åæ˜¯è°ƒç”¨ç¼“å­˜çš„æµ‹è¯•ä»£ç ï¼š</p>
<pre class="lang-java" data-nodeid="745"><code data-language="java"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">MyCacheTest</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;args)</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CacheUtils&nbsp;cache&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;CacheUtils();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;å­˜å…¥ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cache.put(<span class="hljs-string">"key"</span>,&nbsp;<span class="hljs-string">"è€ç‹"</span>,&nbsp;<span class="hljs-number">10</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;æŸ¥è¯¢ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;val&nbsp;=&nbsp;(String)&nbsp;cache.get(<span class="hljs-string">"key"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(val);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;æŸ¥è¯¢ä¸å­˜åœ¨çš„ç¼“å­˜</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;noval&nbsp;=&nbsp;(String)&nbsp;cache.get(<span class="hljs-string">"noval"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(noval);
&nbsp;&nbsp;&nbsp;&nbsp;}
}
</code></pre>
<p data-nodeid="746">ä»¥ä¸Šç¨‹åºçš„æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="747"><code data-language="java">è€ç‹
<span class="hljs-keyword">null</span>
</code></pre>
<p data-nodeid="748">åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè‡ªå®šä¹‰ç¼“å­˜ç³»ç»Ÿå°±å·²ç»å®ç°å®Œäº†ã€‚</p>
<h3 data-nodeid="749">å°ç»“</h3>
<p data-nodeid="750" class="">æœ¬è¯¾æ—¶è®²è§£äº†æœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜è¿™ä¸¤ä¸ªæ¦‚å¿µå’Œå®ç°çš„å…·ä½“æ–¹å¼ï¼Œå…¶ä¸­æœ¬åœ°ç¼“å­˜å¯ä»¥é€šè¿‡è‡ªå·±æ‰‹åŠ¨ç¼–ç æˆ–å€ŸåŠ© Guava Cache æ¥å®ç°ï¼Œè€Œåˆ†å¸ƒå¼ç¼“å­˜å¯ä»¥ä½¿ç”¨ Redis æˆ– EhCache æ¥å®ç°ã€‚æ­¤å¤–ï¼Œæœ¬è¯¾æ—¶é‡ç‚¹æ¼”ç¤ºäº†æ‰‹åŠ¨å®ç°ç¼“å­˜ä»£ç çš„æ–¹å¼å’Œå®ç°æ€è·¯ï¼Œå¹¶ä½¿ç”¨å®šæœŸåˆ é™¤å’Œæƒ°æ€§åˆ é™¤ç­–ç•¥æ¥å®ç°ç¼“å­˜çš„æ¸…é™¤ï¼Œå¸Œæœ›å­¦å®Œæœ¬è¯¾æ—¶åèƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p>

---

### ç²¾é€‰è¯„è®º

##### **è¿œï¼š
> å®šæœŸåˆ é™¤ï¼Œéå†keysetå†getæ˜¯ä¸æ˜¯æ¢æˆç›´æ¥éå†entryè¦é«˜æ•ˆäº›ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¯ä»¥çœ‹ä¸‹æˆ‘çš„è¿™ç¯‡ã€ŠHashMap çš„ 7 ç§éå†æ–¹å¼ä¸æ€§èƒ½åˆ†æï¼ã€‹æœ‰ä¸“é—¨çš„æ€§èƒ½åˆ†æå“ˆ https://mp.weixin.qq.com/s?__biz=MzU1NTkwODE4Mw==&mid=2247485208&idx=1&sn=62be917b1431243b898354d17112b06f&scene=21#wechat_redirect

##### **å¨ï¼š
> è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸‹æ–‡ç« ä¸­çš„æœ¬åœ°ç¼“å­˜å’Œ spring cache æœ‰ä»€ä¹ˆå…³è”ä¹ˆï¼ŸSpring cache ä¹Ÿå¯ä»¥ç¼“å­˜åˆ°æœ¬åœ°çš„

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; spring å†…ç½® cache å±äºæœ¬åœ°ç¼“å­˜çš„ä¸€ç§ï¼Œå®ƒçš„æœ¬è´¨æ˜¯ä½¿ç”¨ map è¿›è¡Œæ•°æ®å­˜å‚¨çš„ã€‚

##### **ä¼Ÿï¼š
> 1.CacheUtilsé‡Œçš„putå’Œgetæ–¹æ³•ï¼Œåœ¨å¹¶å‘æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°é—®é¢˜ã€‚æ¯”å¦‚ï¼Œåœ¨putæ–¹æ³•ä¸­æ‰§è¡Œåˆ°MyCache cache = CacheGlobal.concurrentMap.get(key);ä¹‹åï¼Œè¿›è¡Œè®¾ç½®å€¼ï¼Œè¿˜æ²¡æœ‰è®¾ç½®å®Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±è°ƒç”¨getæ–¹æ³•ï¼Œè¿™æ—¶å€™ï¼Œgetåˆ°çš„MyCacheå€¼ä¸­çš„ä¸€äº›å±æ€§æ˜¯é”™ä¹±çš„ã€‚<div>2.getæ–¹æ³•åªæ˜¯è¿”å›çš„valueå€¼ï¼Œ1ä¸­çš„é—®é¢˜ä¼šå¯¼è‡´valueè·å–ä¸åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¸­è®¾ç½®çš„å€¼ã€‚æ‰€ä»¥<span style="font-size: 16.0125px;">CacheValueçš„valueå€¼æ˜¯ä¸æ˜¯è®¾ç½®æˆvalitaleæ¯”è¾ƒå¥½ã€‚</span></div>

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¾ˆæ£’ï¼Œè¿™æ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ Cache ç±»åªæ˜¯ä¸ºäº†è¯´æ˜è¿‡æœŸç­–ç•¥çš„ã€‚

##### *é£ï¼š
> public int compareTo(CacheValue o) {
        return hitCount.compareTo(o.hitCount);
}è¿™é‡Œçš„ CacheValue è¿™ä¸ªç±»æ˜¯ä»å“ªæ¥çš„ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è¿™é‡Œä¸æ˜¯Â CacheValueÂ å¯¹è±¡è€Œæ˜¯Â MyCacheÂ å¯¹è±¡ï¼Œå†…å®¹ä»¥æ›´æ”¹ï¼Œè¯¾ç¨‹çš„æ‰€æœ‰æºç åœ¨Â githubï¼šhttps://github.com/vipstone/interview-lagou/blob/master/src/main/java/com/lagou/interview/custom/MyCache.java

##### **å¸…ï¼š
> æƒ°æ€§åˆ é™¤ä¸ä¼šä¸»åŠ¨åˆ é™¤è¿‡æœŸé”®ï¼Œè€Œæ˜¯åœ¨æ¯æ¬¡è¯·æ±‚æ—¶æ‰ä¼šåˆ¤æ–­æ­¤å€¼æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤é”®å€¼ï¼Œå¦åˆ™å°±è¿”å› nullã€‚ è¿™é‡Œå¦‚æœè¿‡æœŸçš„è¯åˆ é™¤é”®å€¼ è¿”å›nullï¼Œå¦åˆ™ä¸æ˜¯åº”è¯¥è¿”å›æ­£ç¡®çš„ç»“æœå˜›ï¼Ÿä¸ºä»€ä¹ˆå¦åˆ™å°±è¿”å›null å‘¢ğŸ˜

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ„Ÿè°¢åé¦ˆï¼Œç¬”è¯¯ï¼Œè¿™å—åº”è¯¥æ˜¯â€œå¦åˆ™å°±è¿”å›æ­£å¸¸å€¼â€ï¼Œæ–‡ä¸­å·²æ›´æ­£ã€‚

##### **è€€ï¼š
> å›çœ‹ç¬¬äºŒéï¼Œéå¸¸æœ‰å¸®ç»„ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è¡¥å……äº†è§£å¦‚ä¸‹çŸ¥è¯†ç‚¹ï¼š1.å¼ºå¤§çš„ Apache Igniteï¼ˆæ˜¯ä¸€ä¸ªä»¥å†…å­˜ä¸ºä¸­å¿ƒçš„åˆ†å¸ƒå¼æ•°æ®åº“ã€ç¼“å­˜å’Œå¤„ç†å¹³å°ï¼Œå¯ä»¥åœ¨PBçº§æ•°æ®ä¸­ï¼Œä»¥å†…å­˜çº§çš„é€Ÿåº¦è¿›è¡Œäº‹åŠ¡æ€§ã€åˆ†ææ€§ä»¥åŠæµå¼è´Ÿè½½çš„å¤„ç†ï¼‰2.æ–°ä¸€ä»£çš„ç¼“å­˜Caffeine(æ€§èƒ½æ¯”Google Guavaå¥½)ã€‚ä½œè€…çš„githubæ˜¯(ben-manes - Overview)ï¼Œæ›¾ç»å†™äº†ConcurrentLinkedHashMapè¿™ä¸ªç±»ï¼Œè€Œè¿™ä¸ªç±»åˆæ˜¯GuavaCacheçš„åŸºç¡€ã€‚Ben Manesä¸€æ‹è„‘è¢‹ï¼Œå†³å®šæ›´ä¸Šå±‚æ¥¼ã€‚

##### **çƒ¨ï¼š
> è‡ªå·±å®ç°çš„ç¼“å­˜ä»£ç é‡Œé¢concurrentMapçš„ç±»å‹æ˜¯ConcurrentMapï¼Œè¯¥æ¥å£ä¸å­˜åœ¨keySet()æ–¹æ³•ï¼ŒkeySet()æ–¹æ³•æ˜¯AbstractMapæŠ½è±¡ç±»ä¸­å®šä¹‰çš„

##### **æ˜ï¼š
> &nbsp;&nbsp;<span style="font-size: 0.427rem;">// å½“ç¼“å­˜å­˜åœ¨æ—¶ï¼Œæ›´æ–°ç¼“å­˜</span><div><div>&nbsp; &nbsp; &nbsp; &nbsp; if (CacheGlobal.concurrentMap.containsKey(key)) {</div><div>// å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œåˆ°è¿™ä¸ªä½ç½®,éƒ½å·²ç»å¾—åˆ°äº†cacheå¯¹è±¡,è¿™ä¸ªæ—¶å€™cacheçš„hitcount = 11</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MyCache cache = CacheGlobal.concurrentMap.get(key);</div><div>// è¿™ä¸ªæ—¶å€™ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æˆ–è€…å¹¶å‘å¯¹è¿™ä¸ªhitcountåŠ 1,hitcountå°±ä¼š=12.å…¶å®åº”è¯¥æ˜¯13çš„</div><div>// è¿™ä¸ªæ—¶å€™æ¯ä¸ªçº¿ç¨‹éƒ½ä¿å­˜æœ‰cacheè¿™ä¸ªå‰¯æœ¬,ç›¸äº’ç‹¬ç«‹,æ„Ÿè§‰è¿™ä¸ªåœ°æ–¹æœ‰é—®é¢˜</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cache.setHitCount(cache.getHitCount() + 1);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cache.setWriteTime(System.currentTimeMillis());</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cache.setLastTime(System.currentTimeMillis());</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cache.setExpireTime(expire);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cache.setValue(value);</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;</div><div>&nbsp; &nbsp; &nbsp; &nbsp; }</div></div><div><br></div>

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è¿™æ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ Cache ç±»ï¼Œå…¶å®åªæ˜¯ä¸ºäº†æ¼”ç¤ºè¿‡æœŸç­–ç•¥çš„å“ˆã€‚

##### *è¡Œï¼š
> æƒ°æ€§åˆ é™¤ æ¸…é™¤è¿‡æœŸç¼“å­˜æ˜¯ä¸æ˜¯å†™é”™åˆ†æ”¯äº†

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å—¯ï¼Ÿä¹ˆæœ‰å†™é”™å•Š

##### **ç”Ÿï¼š
> è€å¸ˆè®²çš„å®šæ—¶æˆ–å®šæœŸåˆ é™¤æä¹±äº†ã€‚ã€‚

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯æ¯”è¾ƒç»•ï¼Œå¯ä»¥å¤šçœ‹ä¸¤éå°±æ¸…æ¥šäº†ã€‚

##### *é¹ï¼š
> è·å–ç¼“å­˜å€¼æ–¹æ³•é‡Œï¼Œæ¸…é™¤è¿‡æœŸç¼“å­˜çš„ä½ç½®ä¸æ­£ç¡®

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ‚¨æŒ‡çš„æ˜¯å“ªä¸€è¡Œä»£ç ï¼Œéº»çƒ¦å¤åˆ¶ä¸€ä¸‹ã€‚

##### **æ¹˜ï¼š
> ç¡®å®ä¼šæœ‰å¹¶å‘é—®é¢˜ï¼ŒConcurrentHashMap åªä¿è¯äº†MyCache ä¸ä¼šæœ‰å¹¶å‘é—®é¢˜ï¼Œä½†MyCache é‡Œé¢çš„å±æ€§å€¼å´ä¸èƒ½ä¿è¯ï¼Œå¹¶å‘æƒ…å†µä¸‹ä¼šå¯¼è‡´MyCache å±æ€§çš„å€¼æ··ä¹±

##### **ä¹ï¼š
> æ²¡ä»€ä¹ˆè¯´çš„ å¹²è´§æ»¡æ»¡ğŸ™‹

##### **ç”¨æˆ·8700ï¼š
> è™½ç„¶åŸºäºå¹¶å‘mapï¼Œä½†æ‰‹å†™çš„ç¼“å­˜æ²¡æœ‰è€ƒè™‘å¹¶å‘é—®é¢˜ã€‚è€Œä¸”containæ–¹æ³•æœ‰æ€§èƒ½é—®é¢˜

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; è‡ªå®šä¹‰ç¼“å­˜ä½¿ç”¨çš„æ˜¯ ConcurrentHashMap ä¸ä¼šæœ‰å¹¶å‘é—®é¢˜ï¼ŒHashMap ä¼šæœ‰å¹¶å‘é—®é¢˜ã€‚containsKey åœ¨ JDK 8 æ—¶å› ä¸ºæ•°æ®ç»“æ„åœ¨å¿…è¦æ—¶ä¼šè½¬æˆçº¢é»‘æ ‘ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚å¦‚æœæ˜¯é“¾è¡¨çš„è¯ï¼Œæœ€å·®çš„æƒ…å†µå¯ä»¥æŸ¥è¯¢æ•ˆç‡æ˜¯ O(n)ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œä½† JDK 8 ä¹‹åä¸ä¼šäº†ã€‚

