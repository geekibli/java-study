<p data-nodeid="1521" class="">åœ¨å¹¶å‘ç¼–ç¨‹ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š<strong data-nodeid="1579">çº¿ç¨‹å’Œé”</strong>ï¼Œå¤šçº¿ç¨‹æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œå®ƒåœ¨æé«˜ç¨‹åºæ€§èƒ½çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†ç¼–ç çš„å¤æ‚æ€§ï¼Œå¯¹å¼€å‘è€…çš„è¦æ±‚ä¹Ÿæé«˜äº†ä¸€ä¸ªæ¡£æ¬¡ã€‚è€Œé”çš„å‡ºç°å°±æ˜¯ä¸ºäº†ä¿éšœå¤šçº¿ç¨‹åœ¨åŒæ—¶æ“ä½œä¸€ç»„èµ„æºæ—¶çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå½“æˆ‘ä»¬ç»™èµ„æºåŠ ä¸Šé”ä¹‹åï¼Œåªæœ‰æ‹¥æœ‰æ­¤é”çš„çº¿ç¨‹æ‰èƒ½æ“ä½œæ­¤èµ„æºï¼Œè€Œå…¶ä»–çº¿ç¨‹åªèƒ½æ’é˜Ÿç­‰å¾…ä½¿ç”¨æ­¤é”ã€‚å½“ç„¶ï¼Œåœ¨æ‰€æœ‰çš„é¢è¯•ä¸­ä¹Ÿéƒ½å°‘ä¸äº†å…³äºâ€œé”â€æ–¹é¢çš„ç›¸å…³é—®é¢˜ã€‚</p>
<p data-nodeid="1937" class="">æˆ‘ä»¬æœ¬è¯¾æ—¶çš„é¢è¯•é¢˜æ˜¯ï¼Œå¦‚ä½•æ‰‹åŠ¨æ¨¡æ‹Ÿä¸€ä¸ªæ­»é”ï¼Ÿè°ˆè°ˆä½ å¯¹é”çš„ç†è§£ã€‚</p>


<h3 data-nodeid="1523">å…¸å‹å›ç­”</h3>
<p data-nodeid="1524">æ­»é”æ˜¯æŒ‡ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å ç”¨ä¸¤ä¸ªèµ„æºï¼Œåˆåœ¨å½¼æ­¤ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”èµ„æºï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>
<img src="https://s0.lgstatic.com/i/image3/M01/7D/29/Cgq2xl59tsKAQ8wtAAA5YT3tSNk931.png" alt="" data-nodeid="1585"></p>
<p data-nodeid="1525">æ­»é”çš„ä»£ç æ¼”ç¤ºå¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="1526"><code data-language="java"><span class="hljs-keyword">import</span>&nbsp;java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">LockExample</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;args)</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;deadLock();&nbsp;<span class="hljs-comment">//&nbsp;æ­»é”</span>
&nbsp;&nbsp;&nbsp;&nbsp;}

&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;æ­»é”
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">deadLock</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;lock1&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;Object();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Object&nbsp;lock2&nbsp;=&nbsp;<span class="hljs-keyword">new</span>&nbsp;Object();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;çº¿ç¨‹ä¸€æ‹¥æœ‰&nbsp;lock1&nbsp;è¯•å›¾è·å–&nbsp;lock2</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">new</span>&nbsp;Thread(()&nbsp;-&gt;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">synchronized</span>&nbsp;(lock1)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"è·å–&nbsp;lock1&nbsp;æˆåŠŸ"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="hljs-keyword">catch</span>&nbsp;(InterruptedException&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è¯•å›¾è·å–é”&nbsp;lock2</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">synchronized</span>&nbsp;(lock2)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(Thread.currentThread().getName());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}).start();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;çº¿ç¨‹äºŒæ‹¥æœ‰&nbsp;lock2&nbsp;è¯•å›¾è·å–&nbsp;lock1</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">new</span>&nbsp;Thread(()&nbsp;-&gt;&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">synchronized</span>&nbsp;(lock2)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(<span class="hljs-string">"è·å–&nbsp;lock2&nbsp;æˆåŠŸ"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">try</span>&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TimeUnit.SECONDS.sleep(<span class="hljs-number">3</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;<span class="hljs-keyword">catch</span>&nbsp;(InterruptedException&nbsp;e)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.printStackTrace();
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;è¯•å›¾è·å–é”&nbsp;lock1</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">synchronized</span>&nbsp;(lock1)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(Thread.currentThread().getName());
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}).start();
&nbsp;&nbsp;&nbsp;&nbsp;}
}
</code></pre>
<p data-nodeid="1527">ä»¥ä¸Šç¨‹åºæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="1528"><code data-language="java">è·å–&nbsp;lock1&nbsp;æˆåŠŸ
è·å–&nbsp;lock2&nbsp;æˆåŠŸ
</code></pre>
<p data-nodeid="1529">å¯ä»¥çœ‹å‡ºå½“æˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹ä¸€æ‹¥æœ‰é” lock1 çš„åŒæ—¶è¯•å›¾è·å– lock2ï¼Œè€Œçº¿ç¨‹äºŒåœ¨æ‹¥æœ‰ lock2 çš„åŒæ—¶è¯•å›¾è·å– lock1ï¼Œè¿™æ ·å°±ä¼šé€ æˆå½¼æ­¤éƒ½åœ¨ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œäºæ˜¯å°±å½¢æˆäº†<strong data-nodeid="1593">æ­»é”</strong>ã€‚</p>
<p data-nodeid="3327" class="">é”æ˜¯æŒ‡åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ“ä½œä¸€ä¸ªèµ„æºæ—¶ï¼Œä¸ºäº†ä¿è¯æ•°æ®æ“ä½œçš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬éœ€è¦è®©å¤šçº¿ç¨‹æ’é˜Ÿä¸€ä¸ªä¸€ä¸ªåœ°æ“ä½œæ­¤èµ„æºï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ç»™èµ„æºåŠ é”å’Œé‡Šæ”¾é”çš„è¿‡ç¨‹ï¼Œå°±å¥½åƒå»å…¬å…±å•æ‰€ä¸€æ ·ï¼Œå¿…é¡»ä¸€ä¸ªä¸€ä¸ªæ’é˜Ÿä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨ä½¿ç”¨æ—¶éœ€è¦é”é—¨å’Œå¼€é—¨ä¸€æ ·ã€‚</p>





<h3 data-nodeid="1531">è€ƒç‚¹åˆ†æ</h3>
<p data-nodeid="4737" class="">é”çš„æ¦‚å¿µä¸æ­¢å‡ºç°åœ¨ Java è¯­è¨€ä¸­ï¼Œæ¯”å¦‚<strong data-nodeid="4743">ä¹è§‚é”å’Œæ‚²è§‚é”</strong>å…¶å®å¾ˆæ—©å°±å­˜åœ¨äºæ•°æ®åº“ä¸­äº†ã€‚é”çš„æ¦‚å¿µå…¶å®ä¸éš¾ç†è§£ï¼Œä½†è¦çœŸæ­£åœ°äº†è§£é”çš„åŸç†å’Œå®ç°è¿‡ç¨‹ï¼Œæ‰èƒ½æ‰“åŠ¨é¢è¯•å®˜ã€‚</p>





<p data-nodeid="1533">å’Œé”ç›¸å…³çš„é¢è¯•é—®é¢˜ï¼Œè¿˜æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ul data-nodeid="1534">
<li data-nodeid="1535">
<p data-nodeid="1536">ä»€ä¹ˆæ˜¯ä¹è§‚é”å’Œæ‚²è§‚é”ï¼Ÿå®ƒä»¬çš„åº”ç”¨éƒ½æœ‰å“ªäº›ï¼Ÿä¹è§‚é”æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>
</li>
<li data-nodeid="1537">
<p data-nodeid="1538">ä»€ä¹ˆæ˜¯å¯é‡å…¥é”ï¼Ÿç”¨ä»£ç å¦‚ä½•å®ç°ï¼Ÿå®ƒçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</p>
</li>
<li data-nodeid="1539">
<p data-nodeid="1540">ä»€ä¹ˆæ˜¯å…±äº«é”å’Œç‹¬å é”ï¼Ÿ</p>
</li>
</ul>
<h3 data-nodeid="1541">çŸ¥è¯†æ‰©å±•</h3>
<h4 data-nodeid="1542">1. æ‚²è§‚é”å’Œä¹è§‚é”</h4>
<p data-nodeid="1543">æ‚²è§‚é”æŒ‡çš„æ˜¯æ•°æ®å¯¹å¤–ç•Œçš„ä¿®æ”¹é‡‡å–ä¿å®ˆç­–ç•¥ï¼Œå®ƒè®¤ä¸ºçº¿ç¨‹å¾ˆå®¹æ˜“ä¼šæŠŠæ•°æ®ä¿®æ”¹æ‰ï¼Œå› æ­¤åœ¨æ•´ä¸ªæ•°æ®è¢«ä¿®æ”¹çš„è¿‡ç¨‹ä¸­éƒ½ä¼šé‡‡å–é”å®šçŠ¶æ€ï¼Œç›´åˆ°ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨å®Œï¼Œå…¶ä»–çº¿ç¨‹æ‰å¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚</p>
<p data-nodeid="1544">æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹æ‚²è§‚é”çš„å®ç°æµç¨‹ï¼Œä»¥ synchronized ä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="1545"><code data-language="java"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">LockExample</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;args)</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">synchronized</span>&nbsp;(LockExample.class)&nbsp;{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("lock");
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
}
</code></pre>
<p data-nodeid="1546">æˆ‘ä»¬ä½¿ç”¨åç¼–è¯‘å·¥å…·æŸ¥åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="1547"><code data-language="java">Compiled&nbsp;from&nbsp;"LockExample.java"
public&nbsp;class&nbsp;com.lagou.interview.ext.LockExample&nbsp;{
&nbsp;&nbsp;public&nbsp;com.lagou.interview.ext.LockExample();
&nbsp;&nbsp;&nbsp;&nbsp;Code:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0:&nbsp;aload_0
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1:&nbsp;invokespecial&nbsp;#1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Method&nbsp;java/lang/Object."&lt;init&gt;":()V
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4:&nbsp;return
&nbsp;
&nbsp;&nbsp;public&nbsp;static&nbsp;void&nbsp;main(java.lang.String[]);
&nbsp;&nbsp;&nbsp;&nbsp;Code:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0:&nbsp;ldc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;class&nbsp;com/lagou/interview/ext/LockExample
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2:&nbsp;dup
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3:&nbsp;astore_1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4:&nbsp;monitorenter&nbsp;//&nbsp;åŠ é”
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5:&nbsp;getstatic&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Field&nbsp;java/lang/System.out:Ljava/io/PrintStream;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;8:&nbsp;ldc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;String&nbsp;lock
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10:&nbsp;invokevirtual&nbsp;#5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Method&nbsp;java/io/PrintStream.println:(Ljava/lang/String;)V
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;13:&nbsp;aload_1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;14:&nbsp;monitorexit&nbsp;//&nbsp;é‡Šæ”¾é”
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;15:&nbsp;goto&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;23
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;18:&nbsp;astore_2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;19:&nbsp;aload_1
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20:&nbsp;monitorexit
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;21:&nbsp;aload_2
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;22:&nbsp;athrow
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;23:&nbsp;return
&nbsp;&nbsp;&nbsp;&nbsp;Exception&nbsp;table:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;&nbsp;target&nbsp;type
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;15&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;any
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;&nbsp;21&nbsp;&nbsp;&nbsp;&nbsp;18&nbsp;&nbsp;&nbsp;any
}
</code></pre>
<p data-nodeid="1548">å¯ä»¥çœ‹å‡ºè¢« synchronized ä¿®é¥°çš„ä»£ç å—ï¼Œåœ¨æ‰§è¡Œä¹‹å‰å…ˆä½¿ç”¨ monitorenter æŒ‡ä»¤åŠ é”ï¼Œç„¶ååœ¨æ‰§è¡Œç»“æŸä¹‹åå†ä½¿ç”¨ monitorexit æŒ‡ä»¤é‡Šæ”¾é”èµ„æºï¼Œåœ¨æ•´ä¸ªæ‰§è¡ŒæœŸé—´æ­¤ä»£ç éƒ½æ˜¯é”å®šçš„çŠ¶æ€ï¼Œè¿™å°±æ˜¯<strong data-nodeid="1618">å…¸å‹æ‚²è§‚é”çš„å®ç°æµç¨‹</strong>ã€‚</p>
<p data-nodeid="1549">ä¹è§‚é”å’Œæ‚²è§‚é”çš„æ¦‚å¿µæ°å¥½ç›¸åï¼Œä¹è§‚é”è®¤ä¸ºä¸€èˆ¬æƒ…å†µä¸‹æ•°æ®åœ¨ä¿®æ”¹æ—¶ä¸ä¼šå‡ºç°å†²çªï¼Œæ‰€ä»¥åœ¨æ•°æ®è®¿é—®ä¹‹å‰ä¸ä¼šåŠ é”ï¼Œåªæ˜¯åœ¨æ•°æ®æäº¤æ›´æ”¹æ—¶ï¼Œæ‰ä¼šå¯¹æ•°æ®è¿›è¡Œæ£€æµ‹ã€‚</p>
<p data-nodeid="1550">Java ä¸­çš„ä¹è§‚é”å¤§éƒ¨åˆ†éƒ½æ˜¯é€šè¿‡ CASï¼ˆCompare And Swapï¼Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰æ“ä½œå®ç°çš„ï¼ŒCAS æ˜¯ä¸€ä¸ªå¤šçº¿ç¨‹åŒæ­¥çš„åŸå­æŒ‡ä»¤ï¼ŒCAS æ“ä½œåŒ…å«ä¸‰ä¸ªé‡è¦çš„ä¿¡æ¯ï¼Œå³å†…å­˜ä½ç½®ã€é¢„æœŸåŸå€¼å’Œæ–°å€¼ã€‚å¦‚æœå†…å­˜ä½ç½®çš„å€¼å’Œé¢„æœŸçš„åŸå€¼ç›¸ç­‰çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥æŠŠè¯¥ä½ç½®çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¦åˆ™ä¸åšä»»ä½•ä¿®æ”¹ã€‚</p>
<p data-nodeid="1551">CAS å¯èƒ½ä¼šé€ æˆ ABA çš„é—®é¢˜ï¼ŒABA é—®é¢˜æŒ‡çš„æ˜¯ï¼Œçº¿ç¨‹æ‹¿åˆ°äº†æœ€åˆçš„é¢„æœŸåŸå€¼ Aï¼Œç„¶è€Œåœ¨å°†è¦è¿›è¡Œ CAS çš„æ—¶å€™ï¼Œè¢«å…¶ä»–çº¿ç¨‹æŠ¢å äº†æ‰§è¡Œæƒï¼ŒæŠŠæ­¤å€¼ä» A å˜æˆäº† Bï¼Œç„¶åå…¶ä»–çº¿ç¨‹åˆæŠŠæ­¤å€¼ä» B å˜æˆäº† Aï¼Œç„¶è€Œæ­¤æ—¶çš„ A å€¼å·²ç»å¹¶éåŸæ¥çš„ A å€¼äº†ï¼Œä½†æœ€åˆçš„çº¿ç¨‹å¹¶ä¸çŸ¥é“è¿™ä¸ªæƒ…å†µï¼Œåœ¨å®ƒè¿›è¡Œ CAS çš„æ—¶å€™ï¼Œåªå¯¹æ¯”äº†é¢„æœŸåŸå€¼ä¸º A å°±è¿›è¡Œäº†ä¿®æ”¹ï¼Œè¿™å°±é€ æˆäº† ABA çš„é—®é¢˜ã€‚</p>
<p data-nodeid="1552">ä»¥è­¦åŒªå‰§ä¸ºä¾‹ï¼Œå‡å¦‚æŸäººæŠŠè£…äº† 100W ç°é‡‘çš„ç®±å­æ”¾åœ¨äº†å®¶é‡Œï¼Œå‡ åˆ†é’Ÿä¹‹åè¦æ‹¿å®ƒå»èµäººï¼Œç„¶è€Œåœ¨è¶ä»–ä¸æ³¨æ„çš„æ—¶å€™ï¼Œè¿›æ¥äº†ä¸€ä¸ªå°å·ï¼Œç”¨ç©ºç®±å­æ¢èµ°äº†è£…æ»¡é’±çš„ç®±å­ï¼Œå½“æŸäººè¿›æ¥ä¹‹åçœ‹åˆ°ç®±å­è¿˜æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œä»–ä¼šä»¥ä¸ºè¿™å°±æ˜¯åŸæ¥çš„ç®±å­ï¼Œå°±æ‹¿ç€å®ƒå»èµäººäº†ï¼Œè¿™ç§æƒ…å†µè‚¯å®šæœ‰é—®é¢˜ï¼Œå› ä¸ºç®±å­å·²ç»æ˜¯ç©ºçš„äº†ï¼Œè¿™å°±æ˜¯ ABA çš„é—®é¢˜ã€‚</p>
<p data-nodeid="1553">ABA çš„å¸¸è§å¤„ç†æ–¹å¼æ˜¯æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡ä¿®æ”¹ä¹‹åæ›´æ–°ç‰ˆæœ¬å·ï¼Œæ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œå‡å¦‚æ¯æ¬¡ç§»åŠ¨ç®±å­ä¹‹åï¼Œç®±å­çš„ä½ç½®å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè€Œè¿™ä¸ªå˜åŒ–çš„ä½ç½®å°±ç›¸å½“äºâ€œç‰ˆæœ¬å·â€ï¼Œå½“æŸäººè¿›æ¥ä¹‹åå‘ç°ç®±å­çš„ä½ç½®å‘ç”Ÿäº†å˜åŒ–å°±çŸ¥é“æœ‰äººåŠ¨äº†æ‰‹è„šï¼Œå°±ä¼šæ”¾å¼ƒåŸæœ‰çš„è®¡åˆ’ï¼Œè¿™æ ·å°±è§£å†³äº† ABA çš„é—®é¢˜ã€‚</p>
<p data-nodeid="1554">JDK åœ¨ 1.5 æ—¶æä¾›äº† AtomicStampedReference ç±»ä¹Ÿå¯ä»¥è§£å†³ ABA çš„é—®é¢˜ï¼Œæ­¤ç±»ç»´æŠ¤äº†ä¸€ä¸ªâ€œç‰ˆæœ¬å·â€ Stampï¼Œæ¯æ¬¡åœ¨æ¯”è¾ƒæ—¶ä¸æ­¢æ¯”è¾ƒå½“å‰å€¼è¿˜æ¯”è¾ƒç‰ˆæœ¬å·ï¼Œè¿™æ ·å°±è§£å†³äº† ABA çš„é—®é¢˜ã€‚</p>
<p data-nodeid="1555">ç›¸å…³æºç å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="1556"><code data-language="java"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">AtomicStampedReference</span>&lt;<span class="hljs-title">V</span>&gt;&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">Pair</span>&lt;<span class="hljs-title">T</span>&gt;&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">final</span>&nbsp;T&nbsp;reference;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">final</span>&nbsp;<span class="hljs-keyword">int</span>&nbsp;stamp;&nbsp;<span class="hljs-comment">//&nbsp;â€œç‰ˆæœ¬å·â€</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">private</span>&nbsp;<span class="hljs-title">Pair</span><span class="hljs-params">(T&nbsp;reference,&nbsp;<span class="hljs-keyword">int</span>&nbsp;stamp)</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.reference&nbsp;=&nbsp;reference;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">this</span>.stamp&nbsp;=&nbsp;stamp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">static</span>&nbsp;&lt;T&gt;&nbsp;<span class="hljs-function">Pair&lt;T&gt;&nbsp;<span class="hljs-title">of</span><span class="hljs-params">(T&nbsp;reference,&nbsp;<span class="hljs-keyword">int</span>&nbsp;stamp)</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>&nbsp;<span class="hljs-keyword">new</span>&nbsp;Pair&lt;T&gt;(reference,&nbsp;stamp);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//&nbsp;æ¯”è¾ƒå¹¶è®¾ç½®</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">boolean</span>&nbsp;<span class="hljs-title">compareAndSet</span><span class="hljs-params">(V&nbsp;&nbsp;&nbsp;expectedReference,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;V&nbsp;&nbsp;&nbsp;newReference,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">int</span>&nbsp;expectedStamp,&nbsp;//&nbsp;åŸç‰ˆæœ¬å·
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">int</span>&nbsp;newStamp)</span>&nbsp;</span>{&nbsp;<span class="hljs-comment">//&nbsp;æ–°ç‰ˆæœ¬å·</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pair&lt;V&gt;&nbsp;current&nbsp;=&nbsp;pair;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-keyword">return</span>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expectedReference&nbsp;==&nbsp;current.reference&nbsp;&amp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;expectedStamp&nbsp;==&nbsp;current.stamp&nbsp;&amp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((newReference&nbsp;==&nbsp;current.reference&nbsp;&amp;&amp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;newStamp&nbsp;==&nbsp;current.stamp)&nbsp;||
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;casPair(current,&nbsp;Pair.of(newReference,&nbsp;newStamp)));
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">//.......çœç•¥å…¶ä»–æºç </span>
}
</code></pre>
<p data-nodeid="1557">å¯ä»¥çœ‹å‡ºå®ƒåœ¨ä¿®æ”¹æ—¶ä¼šè¿›è¡ŒåŸå€¼æ¯”è¾ƒå’Œç‰ˆæœ¬å·æ¯”è¾ƒï¼Œå½“æ¯”è¾ƒæˆåŠŸä¹‹åä¼šä¿®æ”¹å€¼å¹¶ä¿®æ”¹ç‰ˆæœ¬å·ã€‚</p>
<blockquote data-nodeid="1558">
<p data-nodeid="1559">å°è´´å£«ï¼šä¹è§‚é”æœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼Œå®ƒåœ¨æäº¤çš„æ—¶å€™æ‰è¿›è¡Œé”å®šçš„ï¼Œå› æ­¤ä¸ä¼šé€ æˆæ­»é”ã€‚</p>
</blockquote>
<h4 data-nodeid="1560">2. å¯é‡å…¥é”</h4>
<p data-nodeid="1561">å¯é‡å…¥é”ä¹Ÿå«<strong data-nodeid="1636">é€’å½’é”</strong>ï¼ŒæŒ‡çš„æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœå¤–é¢çš„å‡½æ•°æ‹¥æœ‰æ­¤é”ä¹‹åï¼Œå†…å±‚çš„å‡½æ•°ä¹Ÿå¯ä»¥ç»§ç»­è·å–è¯¥é”ã€‚åœ¨ Java è¯­è¨€ä¸­ ReentrantLock å’Œ synchronized éƒ½æ˜¯å¯é‡å…¥é”ã€‚</p>
<p data-nodeid="1562">ä¸‹é¢æˆ‘ä»¬ç”¨ synchronized æ¥æ¼”ç¤ºä¸€ä¸‹ä»€ä¹ˆæ˜¯å¯é‡å…¥é”ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="1563"><code data-language="java"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-class"><span class="hljs-keyword">class</span>&nbsp;<span class="hljs-title">LockExample</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">public</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">main</span><span class="hljs-params">(String[]&nbsp;args)</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reentrantA();&nbsp;<span class="hljs-comment">//&nbsp;å¯é‡å…¥é”</span>
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;å¯é‡å…¥é”&nbsp;A&nbsp;æ–¹æ³•
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">synchronized</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">reentrantA</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(Thread.currentThread().getName()&nbsp;+&nbsp;<span class="hljs-string">"ï¼šæ‰§è¡Œ&nbsp;reentrantA"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reentrantB();
&nbsp;&nbsp;&nbsp;&nbsp;}
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-comment">/**
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;å¯é‡å…¥é”&nbsp;B&nbsp;æ–¹æ³•
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*/</span>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="hljs-function"><span class="hljs-keyword">private</span>&nbsp;<span class="hljs-keyword">synchronized</span>&nbsp;<span class="hljs-keyword">static</span>&nbsp;<span class="hljs-keyword">void</span>&nbsp;<span class="hljs-title">reentrantB</span><span class="hljs-params">()</span>&nbsp;</span>{
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(Thread.currentThread().getName()&nbsp;+&nbsp;<span class="hljs-string">"ï¼šæ‰§è¡Œ&nbsp;reentrantB"</span>);
&nbsp;&nbsp;&nbsp;&nbsp;}
}
</code></pre>
<p data-nodeid="1564">ä»¥ä¸Šä»£ç çš„æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre class="lang-java" data-nodeid="1565"><code data-language="java">mainï¼šæ‰§è¡Œ&nbsp;reentrantA
mainï¼šæ‰§è¡Œ&nbsp;reentrantB
</code></pre>
<p data-nodeid="1566">ä»ç»“æœå¯ä»¥çœ‹å‡º reentrantA æ–¹æ³•å’Œ reentrantB æ–¹æ³•çš„æ‰§è¡Œçº¿ç¨‹éƒ½æ˜¯â€œmainâ€ ï¼Œæˆ‘ä»¬è°ƒç”¨äº† reentrantA æ–¹æ³•ï¼Œå®ƒçš„æ–¹æ³•ä¸­åµŒå¥—äº† reentrantBï¼Œå¦‚æœ synchronized æ˜¯ä¸å¯é‡å…¥çš„è¯ï¼Œé‚£ä¹ˆçº¿ç¨‹ä¼šè¢«ä¸€ç›´å µå¡ã€‚</p>
<p data-nodeid="1567">å¯é‡å…¥é”çš„å®ç°åŸç†ï¼Œæ˜¯åœ¨é”å†…éƒ¨å­˜å‚¨äº†ä¸€ä¸ªçº¿ç¨‹æ ‡è¯†ï¼Œç”¨äºåˆ¤æ–­å½“å‰çš„é”å±äºå“ªä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”é”çš„å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“é”ç©ºé—²æ—¶æ­¤è®¡æ•°å™¨çš„å€¼ä¸º 0ï¼Œå½“è¢«çº¿ç¨‹å ç”¨å’Œé‡å…¥æ—¶åˆ†åˆ«åŠ  1ï¼Œå½“é”è¢«é‡Šæ”¾æ—¶è®¡æ•°å™¨å‡ 1ï¼Œç›´åˆ°å‡åˆ° 0 æ—¶è¡¨ç¤ºæ­¤é”ä¸ºç©ºé—²çŠ¶æ€ã€‚</p>
<h4 data-nodeid="1568">3. å…±äº«é”å’Œç‹¬å é”</h4>
<p data-nodeid="1569" class="">åªèƒ½è¢«å•çº¿ç¨‹æŒæœ‰çš„é”å«<strong data-nodeid="1653">ç‹¬å é”</strong>ï¼Œå¯ä»¥è¢«å¤šçº¿ç¨‹æŒæœ‰çš„é”å«<strong data-nodeid="1654">å…±äº«é”</strong>ã€‚</p>
<p data-nodeid="1570">ç‹¬å é”æŒ‡çš„æ˜¯åœ¨ä»»ä½•æ—¶å€™æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰è¯¥é”ï¼Œæ¯”å¦‚ synchronized å°±æ˜¯ç‹¬å é”ï¼Œè€Œ ReadWriteLock è¯»å†™é”å…è®¸åŒä¸€æ—¶é—´å†…æœ‰å¤šä¸ªçº¿ç¨‹è¿›è¡Œè¯»æ“ä½œï¼Œå®ƒå°±å±äºå…±äº«é”ã€‚</p>
<p data-nodeid="1571">ç‹¬å é”å¯ä»¥ç†è§£ä¸ºæ‚²è§‚é”ï¼Œå½“æ¯æ¬¡è®¿é—®èµ„æºæ—¶éƒ½è¦åŠ ä¸Šäº’æ–¥é”ï¼Œè€Œå…±äº«é”å¯ä»¥ç†è§£ä¸ºä¹è§‚é”ï¼Œå®ƒæ”¾å®½äº†åŠ é”çš„æ¡ä»¶ï¼Œå…è®¸å¤šçº¿ç¨‹åŒæ—¶è®¿é—®è¯¥èµ„æºã€‚</p>
<h3 data-nodeid="1572">å°ç»“</h3>
<p data-nodeid="1573" class="">æœ¬è¯¾æ—¶æˆ‘ä»¬è®²äº†æ‚²è§‚é”å’Œä¹è§‚é”ï¼Œå…¶ä¸­æ‚²è§‚é”çš„å…¸å‹åº”ç”¨ä¸º synchronizedï¼Œå®ƒçš„ç‰¹æ€§ä¸ºç‹¬å å¼äº’æ–¥é”ï¼›è€Œä¹è§‚é”ç›¸æ¯”äºæ‚²è§‚é”è€Œè¨€ï¼Œæ‹¥æœ‰æ›´å¥½çš„æ€§èƒ½ï¼Œä½†ä¹è§‚é”å¯èƒ½ä¼šå¯¼è‡´ ABA çš„é—®é¢˜ï¼Œå¸¸è§çš„è§£å†³æ–¹æ¡ˆæ˜¯æ·»åŠ ç‰ˆæœ¬å·æ¥é˜²æ­¢ ABA é—®é¢˜çš„å‘ç”Ÿã€‚åŒæ—¶ï¼Œè¿˜è®²äº†å¯é‡å…¥é”ï¼Œåœ¨ Java ä¸­ï¼Œsynchronized å’Œ ReentrantLock éƒ½æ˜¯å¯é‡å…¥é”ã€‚æœ€åï¼Œè®²äº†ç‹¬å é”å’Œå…±äº«é”ï¼Œå…¶ä¸­ç‹¬å é”å¯ä»¥ç†è§£ä¸ºæ‚²è§‚é”ï¼Œè€Œå…±äº«é”å¯ä»¥ç†è§£ä¸ºä¹è§‚é”ã€‚</p>

---

### ç²¾é€‰è¯„è®º

##### **å…´ï¼š
> æˆ‘å¯¹å…±äº«é”å’Œæ’å®ƒé”æœ‰ä¸åŒç†è§£<div><span style="font-size: 16px; -webkit-tap-highlight-color: rgba(26, 26, 26, 0.301961); -webkit-text-size-adjust: auto; caret-color: rgb(34, 34, 34); color: rgb(34, 34, 34); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;">å…±äº«é”ï¼Œåˆç§°ä¸ºè¯»é”ï¼Œè·å¾—å…±äº«é”ä¹‹åï¼Œå¯ä»¥æŸ¥çœ‹ä½†æ— æ³•ä¿®æ”¹å’Œåˆ é™¤æ•°æ®ã€‚</span><br style="font-size: 16px; -webkit-tap-highlight-color: rgba(26, 26, 26, 0.301961); -webkit-text-size-adjust: auto; -webkit-overflow-scrolling: touch; box-sizing: border-box; caret-color: rgb(34, 34, 34); color: rgb(34, 34, 34); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;"><span style="font-size: 16px; -webkit-tap-highlight-color: rgba(26, 26, 26, 0.301961); -webkit-text-size-adjust: auto; caret-color: rgb(34, 34, 34); color: rgb(34, 34, 34); font-family: -apple-system, &quot;SF UI Text&quot;, Arial, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif, SimHei, SimSun;">æ’ä»–é”ï¼Œåˆç§°ä¸ºå†™é”ã€ç‹¬å é”ã€‚è·å‡†æ’ä»–é”åï¼Œæ—¢èƒ½è¯»æ•°æ®ï¼Œåˆèƒ½ä¿®æ”¹æ•°æ®</span><br></div>

##### **å¤©ï¼š
> ABAç”¨å‰å¦»ç»“äº†ä¸€æ¬¡å©šåˆç¦»äº†å†å›æ¥å¤å©šæ›´è´´åˆ‡ğŸ˜…ğŸ˜›

##### **çš“ï¼š
> ä¹è§‚é”é˜²æ­¢ABAé—®é¢˜çš„è¯ï¼Œæ•°æ®åº“é‡Œåªæ¯”è¾ƒç‰ˆæœ¬å·å°±å¥½äº†ï¼Œä¸ºä»€ä¹ˆjavaé‡Œcasçš„åŒæ—¶è¿˜è¦æ¯”è¾ƒç‰ˆæœ¬å·ï¼Ÿ

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; ç‰ˆæœ¬å·çš„å®ç°æœºåˆ¶æœ‰å¾ˆå¤šç§ï¼Œå¯ä»¥åœ¨æ•°æ®åº“å±‚é¢å»å®ç°ä¹Ÿå¯ä»¥åœ¨ Java ä»£ç ä¸­å®ç°ï¼Œé‡‡å–ä»»æ„ä¸€ç§éƒ½æ˜¯å¯ä»¥çš„ã€‚

##### **æ°¸ï¼š
> æ˜ç™½äº†ï¼Œå› ä¸ºä¹è§‚é”å¹¶æ²¡æœ‰å¯¹å…±äº«èµ„æºåŠ é”ï¼Œåªæ˜¯cas

##### **æ°¸ï¼š
> è€å¸ˆï¼Œä¸ºä»€ä¹ˆä¹è§‚é”åœ¨æäº¤æ—¶è¿›è¡Œé”å®šï¼Œå°±ä¸ä¼šé€ æˆæ­»é”äº†å‘€ï¼Œæ­»é”æœ‰å››ä¸ªå¿…è¦æ¡ä»¶ï¼Œä»–ç ´åäº†å“ªä¸ªå‘¢

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; ä¹è§‚é”ä¸æ˜¯äº’æ–¥çš„å“¦

##### **å½ªï¼š
> å¥½æ–‡ï¼Œä»Šå¤©ç»ˆäºæ˜ç™½äº†ä»€ä¹ˆå«å¯é‡å…¥é”äº†ã€‚ä¸€ç›´çŸ¥é“å¯é‡å…¥é”è¿™ä¸ªè¯è¯­ï¼Œå¹¶ä¸çŸ¥é“å•¥å«å¯é‡å…¥é”çš„èƒŒåçš„æ„æ€ã€‚

##### *è¶…ï¼š
> è€å¸ˆï¼Œæœ‰ä¸ªé—®é¢˜ä¸å¤ªæ˜ç™½ï¼Œcasæ—¢ç„¶æ˜¯åŸå­æ“ä½œï¼Œä¸ºä»€ä¹ˆåœ¨açº¿ç¨‹å–åˆ°æœŸæœ›å€¼ä¹‹åæ²¡æœ‰æ¯”è¾ƒï¼Œè€Œè¢«bçº¿ç¨‹æŠ¢å äº†æ‰§è¡Œæƒï¼Œæˆ‘ç†è§£çš„åŸå­æ“ä½œï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¼šå—ä»»ä½•çš„å¹²æ‰°ï¼Œä¸çŸ¥é“å“ªé‡Œç†è§£ä¸å¤ªå¯¹ï¼Œè¿˜è¯·è€å¸ˆæŒ‡ç‚¹

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; CAS ä¿è¯äº†åŸå­æ€§ï¼Œä½†å­˜åœ¨ ABA çš„é—®é¢˜ã€‚å¯ä»¥ç†è§£ä¸ºåŸå­æ“ä½œåªèƒ½ä¿è¯ä¸€ä¸ªæ­¥éª¤æ‰§è¡Œçš„å®Œæ•´æ€§ï¼Œä½†ABAé—®é¢˜æ˜¯ç»„åˆæ“ä½œï¼Œæ‰€ä»¥ä¼šå­˜åœ¨é—®é¢˜ã€‚

##### **é¾™ï¼š
> å¯é‡å…¥é”é‚£ä¸ªä¾‹å­æ²¡çœ‹æ‡‚ï¼Œå•çº¿ç¨‹é¡ºåºæ‰§è¡Œï¼Œæ€ä¹ˆå°±è¯´æ˜ä»–æ˜¯å¯é‡å…¥çš„

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å¯é‡å…¥é”æŒ‡çš„å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯ä»¥â€œé‡å…¥â€

##### *é¸Ÿï¼š
> è®²è§£ç”ŸåŠ¨å½¢è±¡ï¼æ—¥å¸¸å‚¬æ›´ï¼

 ###### &nbsp;&nbsp;&nbsp; ç¼–è¾‘å›å¤ï¼š
> &nbsp;&nbsp;&nbsp; å·²åé¦ˆç»™è€å¸ˆå“¦ï¼Œåé¢ä¼šåŠ å¿«æ›´æ–°èŠ‚å¥ã€‚

##### **ç”¨æˆ·7139ï¼š
> ç¬¬äº”è¯¾è¯´çš„æ˜¯Reentrantlock åŸºäºAQS

 ###### &nbsp;&nbsp;&nbsp; è®²å¸ˆå›å¤ï¼š
> &nbsp;&nbsp;&nbsp; æ˜¯

